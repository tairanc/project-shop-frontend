webpackJsonp([64],{KSrU:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("kvg+"),s=o("1G+u"),a=o("wSwi"),n=o("VXZc"),l={data:function(){var e=this;return{loading:!1,addVisibleid:!1,selectVisible:!1,goodsIds:"",itemList:[],is_set_expiry_date:"",total:0,goodsVisible:!1,couponInfo:{coupon_id:void 0},pageInfo:{page:1,page_size:20,coupon_id:void 0,item_search:null},couponDetail:{extend:{}},columns:[{label:"商品ID",field:"item_id",align:"center"},{label:"商品名称",align:"center",isGood:2},{label:"标准售价(元)",field:"sell_price",align:"center"},{label:"操作",align:"center",actions:[{label:"关闭",type:"text",size:"mini",disable:function(t,o){return 0==t.status||2==e.couponDetail.status||3==e.couponDetail.status||1==e.couponDetail.status&&0==e.couponDetail.can_obtain},click:function(t,o){e.closeCouponItem(e.couponInfo.coupon_id,o.item_id)}}]}]}},methods:{getCouponDetail:function(e){var t=this;i.a.getShopcoupon(e).then(function(e){t.couponDetail=e.data,t.is_set_expiry_date=parseInt(JSON.parse(e.data.extend.arguments).is_set_expiry_date)})},getCouponAppliedItems:function(e){var t=this;i.a.getCouponAppliedItems(e).then(function(e){t.itemList=e.data.list,t.total=e.data.total_count})},closeCouponItem:function(e,t){var o=this;this.$confirm("确定关闭该商品的活动状态？","关闭提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.a.closeCouponItem({coupon_id:e,item_ids:t}).then(function(e){e.data?(o.$message({showClose:!0,message:"商品关闭成功",type:"success",duration:1e3}),o.getCouponAppliedItems(o.pageInfo)):o.$message({showClose:!0,message:e.message,type:"error",duration:1e3})})}).catch(function(){o.$message({type:"info",message:"已取消关闭商品"})})},addTicketGoods:function(){var e=this;i.a.addGoodsById({coupon_id:this.couponInfo.coupon_id,item_ids:this.goodsIds}).then(function(t){if(0!=t.data.fail){for(var o="",i=t.data.message,s=t.data.message.length,a=0;a<s;a++)o+="<p>"+i[a]+"</p>";e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:o,type:"warning"})}else e.$message({showClose:!0,message:"添加商品成功",type:"success"}),e.addVisibleid=!1,e.getCouponAppliedItems(e.pageInfo)},function(t){e.$message({showClose:!0,message:t.message,type:"warning"})})},addItemBomb:function(){this.addVisibleid=!0,this.goodsIds=""},backList:function(){this.$router.push({name:"ticket"})},searchItem:function(){this.pageInfo.page=1,this.getCouponAppliedItems(this.pageInfo)},resetSearch:function(){this.pageInfo.item_search="",this.pageInfo.page=1,this.getCouponAppliedItems(this.pageInfo)},sizeChange:function(e){this.pageInfo.page_size=e,this.getCouponAppliedItems(this.pageInfo)},pageChange:function(e){this.pageInfo.page=e,this.getCouponAppliedItems(this.pageInfo)},handleVisible:function(e){this.selectVisible=e},handleAdd:function(e){this.goodsIds=e,this.addTicketGoods()}},components:{TableView:s.a,PaginationView:n.a,SelectGoods:a.a},computed:{platform:function(){var e="",t=this.couponDetail.extend.applicable_platform;if(void 0!=t)return"ALL"==t&&(e+="全平台，"),-1!=t.indexOf("PC")&&(e+="PC端，"),-1!=t.indexOf("WX")&&(e+="微信端，"),-1!=t.indexOf("APP")&&(e+="APP端，"),-1!=t.indexOf("WAP")&&(e+="WAP端，"),e.slice(0,-1)}},created:function(){this.couponInfo.coupon_id=this.$route.query.id,this.pageInfo.coupon_id=this.$route.query.id,this.getCouponDetail(this.couponInfo),this.getCouponAppliedItems(this.pageInfo)}},c={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"detail"},[o("div",{staticClass:"content"},[o("h3",[e._v("优惠券信息")]),e._v(" "),o("el-row",[o("el-col",[o("p",[e._v("优惠券ID： "+e._s(e.couponDetail.id))])]),e._v(" "),o("el-col",[o("p",[e._v("优惠券名称： "+e._s(e.couponDetail.name))])]),e._v(" "),o("el-col",[o("p",[e._v("门槛金额： ¥"+e._s(e.couponDetail.limit_money))])]),e._v(" "),o("el-col",[o("p",[e._v("优惠金额： ¥"+e._s(e.couponDetail.deduct_money))])]),e._v(" "),o("el-col",[o("p",[e._v("发放数量： "+e._s(e.couponDetail.send_quantity))])]),e._v(" "),o("el-col",[o("p",[e._v("每人每张限领： "+e._s(e.couponDetail.user_obtain_limit))])]),e._v(" "),o("el-col",[o("p",[e._v("是否显示入口： "+e._s(1==e.couponDetail.is_show?"是":"否"))])]),e._v(" "),o("el-col",[o("p",[e._v("适用平台： "+e._s(e.platform)+"\n        ")])]),e._v(" "),o("el-col",[o("p",[e._v("创建时间： "+e._s(e.couponDetail.extend.created_at))])]),e._v(" "),o("el-col",[o("p",[e._v("领取开始时间： "+e._s(e.couponDetail.obtain_start_time))])]),e._v(" "),o("el-col",[o("p",[e._v("领取结束时间： "+e._s(e.couponDetail.obtain_end_time))])]),e._v(" "),1==e.is_set_expiry_date?o("el-col",[o("p",[e._v("使用有效期: "+e._s(e.couponDetail.extend.expiry_date)+"天")])]):e._e(),e._v(" "),0==e.is_set_expiry_date?o("el-col",[o("p",[e._v("使用开始时间： "+e._s(e.couponDetail.use_start_time))])]):e._e(),e._v(" "),0==e.is_set_expiry_date?o("el-col",[o("p",[e._v("使用结束时间： "+e._s(e.couponDetail.use_end_time))])]):e._e()],1),e._v(" "),o("el-row",[o("h3",[e._v("商品信息")]),e._v(" "),o("el-col",[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.selectVisible=!0}}},[e._v("选择商品")]),e._v(" "),o("el-button",{on:{click:e.addItemBomb}},[e._v("批量导入商品")]),e._v(" "),o("el-input",{staticClass:"item_search",attrs:{placeholder:"请输入商品 ID 进行搜索",clearable:""},model:{value:e.pageInfo.item_search,callback:function(t){e.$set(e.pageInfo,"item_search",t)},expression:"pageInfo.item_search\t"}}),e._v(" "),o("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchItem}},[e._v("搜索")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.resetSearch}},[e._v("重置")])],1),e._v(" "),o("el-col",{staticClass:"mt20",attrs:{span:16}},[o("table-view",{attrs:{loading:e.loading,columns:e.columns,pageList:e.itemList}}),e._v(" "),o("pagination-view",{attrs:{currentPage:e.pageInfo.page,total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}})],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:e.addVisibleid},on:{"update:visible":function(t){e.addVisibleid=t}}},[o("el-form",[o("el-form-item",[o("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:e.goodsIds,callback:function(t){e.goodsIds=t},expression:"goodsIds"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.addVisibleid=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.addTicketGoods}},[e._v("确 定")])],1)],1),e._v(" "),o("select-goods",{attrs:{selectVisible:e.selectVisible},on:{"visible-change":e.handleVisible,"choose-submit":e.handleAdd}}),e._v(" "),o("el-row",{staticClass:"mt40",attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:2}},[o("el-button",{attrs:{type:"primary"},on:{click:e.backList}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var p=o("C7Lr")(l,c,!1,function(e){o("ddUM")},"data-v-5babd2c8",null);t.default=p.exports},ddUM:function(e,t){}});
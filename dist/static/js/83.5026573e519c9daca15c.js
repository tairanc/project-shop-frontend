webpackJsonp([83],{bIXT:function(t,e){},v3Pd:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("3cXf"),s=o.n(i),a=o("wSwi"),n=o("kvg+"),d=o("KJHC"),r=o("6PaB"),l=/^[1-9]+\d*$/,u={data:function(){var t=this,e=function(t,e,o){e?l.test(e)?o():o(new Error("请输入正整数")):o(new Error("请填写必填项"))};return{showBtnBatch:!1,type:"OptionBuy",addVisibleid:!1,selectVisible:!1,goodsIds:"",goodsList:[],commitData:{},addCoupon:{promotion_id:"",promotion_name:"",start_time:"",end_time:"",items:[],amount:"",quantity:""},addRules:{promotion_name:[{required:!0,message:"请输入1~60个字符",trigger:"blur"},{min:1,max:60,message:"请输入1~60个字符",trigger:"blur"}],amount:[{validator:e,trigger:"blur"}],quantity:[{validator:e,trigger:"blur"}],start_time:[{validator:function(e,o,i){o?(t.$refs.addCoupon.validateField("end_time"),i()):i(new Error("请选择活动开始时间"))},trigger:"blur"}],end_time:[{validator:function(e,o,i){o?o<t.addCoupon.start_time?i(new Error("活动结束时间需要大于活动开始时间")):i():i(new Error("请选择活动结束时间"))},trigger:"blur"}]}}},computed:{selectList:function(){var t=[];return this.goodsList.map(function(e){-1==t.indexOf(e.item_id)&&t.push(e.item_id)}),t},spanArr:function(){return Object(r.a)(this.goodsList)}},methods:{getOptionBuyDetail:function(t){var e=this;d.a.getOptionBuyDetail(t).then(function(t){0==t.code&&(e.showBtnBatch=10!=t.data.status,e.addCoupon.promotion_name=t.data.name,e.addCoupon.start_time=t.data.start_time,e.addCoupon.end_time=t.data.end_time,e.addCoupon.amount=t.data.rules.amount,e.addCoupon.quantity=t.data.rules.quantity,e.goodsList=t.data.itemList.list)})},addItemBomb:function(){this.addVisibleid=!0,this.goodsIds=""},addGoodsById:function(){var t=this;if(this.goodsIds){var e=JSON.parse(s()(this.goodsIds));if(0==this.showBtnBatch){var o=[];-1!=this.goodsIds.indexOf(",")?o=this.goodsIds.split(","):-1!=this.goodsIds.indexOf("，")?o=this.goodsIds.split("，"):o.push(this.goodsIds),this.goodsList.map(function(t,e){-1==o.indexOf(t.item_id)&&o.push(t.item_id)}),e=o.join(",")}n.a.importItemsById({item_id:e,promotion_type:"OptionBuy",promotion_id:this.addCoupon.promotion_id,return_by:"sku"}).then(function(e){var o=e.data,i="";if(0!=o.itemList.length&&t.goodsFilter(o.itemList),0!=o.inValidItems.length)for(var s=0;s<o.inValidItems.length;s++)i+="<p>异常商品ID:"+o.inValidItems[s]+"</p>";if(0!=o.unsatisfiedItems.length)for(var a=0;a<o.unsatisfiedItems.length;a++)i+="<p>参加了不可叠加的商品:"+o.unsatisfiedItems[a]+"</p>";i&&t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:i,type:"warning"})})}this.goodsIds="",this.addVisibleid=!1},goodsFilter:function(t){for(var e=0;e<t.length;e++){var o=!1;if(0!=this.goodsList.length)for(var i=0;i<this.goodsList.length;i++)t[e].id==this.goodsList[i].id&&(o=!0);o||this.goodsList.push(t[e])}var s=[];t.map(function(t){s.push(t.item_id)});for(var a=0;a<this.goodsList.length;a++)-1==s.indexOf(this.goodsList[a].item_id)&&(this.goodsList.splice(a,1),a--)},handleVisible:function(t){this.selectVisible=t},handleAdd:function(t){var e=this;n.a.importItemsById({item_id:t,promotion_type:"OptionBuy",promotion_id:this.addCoupon.promotion_id,return_by:"sku"}).then(function(t){var o=t.data,i="";if(0!=o.itemList.length&&e.goodsFilter(o.itemList),0!=o.inValidItems.length)for(var s=0;s<o.inValidItems.length;s++)i+="<p>异常商品ID:"+o.inValidItems[s]+"</p>";if(0!=o.unsatisfiedItems.length)for(var a=0;a<o.unsatisfiedItems.length;a++)i+="<p>参加了不可叠加的商品:"+o.unsatisfiedItems[a]+"</p>";i&&e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:i,type:"warning"})})},spanMethod:function(t){t.row,t.column;var e=t.rowIndex,o=t.columnIndex;if(0===o||1===o||2===o||7===o)return 1==this.spanArr[e]?{rowspan:0,colspan:0}:0==this.spanArr[e]?{rowspan:1,colspan:1}:{rowspan:this.spanArr[e],colspan:1}},handleDelete:function(t){this.goodsList=this.goodsList.filter(function(e){return e.item_id!=t.item_id})},handleSubmit:function(){var t=this;this.$refs.addCoupon.validate(function(e){if(e){var o=[];t.goodsList.map(function(t){o.push({item_id:t.item_id,sku_id:t.id})}),t.addCoupon.items=s()(o),d.a.updateOptionBuy(t.addCoupon).then(function(e){0==e.code&&(t.$message({showClose:!0,message:"创建成功",type:"success"}),t.$router.push({name:"option"}))})}})},handleCancel:function(){this.$router.push({name:"option"})}},components:{SelectGoods:a.a},created:function(){this.addCoupon.promotion_id=this.$route.query.id,this.getOptionBuyDetail({promotion_id:this.addCoupon.promotion_id,page:1,page_size:-1})}},p={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-form",{ref:"addCoupon",attrs:{model:t.addCoupon,rules:t.addRules,"label-width":"120px"}},[o("div",{staticClass:"basic"},[o("el-form-item",{attrs:{label:"活动名称:",prop:"promotion_name"}},[o("el-input",{attrs:{placeholder:"活动名称"},model:{value:t.addCoupon.promotion_name,callback:function(e){t.$set(t.addCoupon,"promotion_name",e)},expression:"addCoupon.promotion_name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"金额:",prop:"amount"}},[o("el-input",{attrs:{placeholder:"仅限输入正整数"},model:{value:t.addCoupon.amount,callback:function(e){t.$set(t.addCoupon,"amount",e)},expression:"addCoupon.amount"}}),t._v(" 元\n    ")],1),t._v(" "),o("el-form-item",{attrs:{label:"任选:",prop:"quantity"}},[o("el-input",{attrs:{placeholder:"仅限输入正整数"},model:{value:t.addCoupon.quantity,callback:function(e){t.$set(t.addCoupon,"quantity",e)},expression:"addCoupon.quantity"}}),t._v(" 件\n    ")],1),t._v(" "),o("el-form-item",{attrs:{label:"活动开始时间:",prop:"start_time"}},[o("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"活动开始时间"},model:{value:t.addCoupon.start_time,callback:function(e){t.$set(t.addCoupon,"start_time",e)},expression:"addCoupon.start_time"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"活动结束时间:",prop:"end_time"}},[o("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"活动结束时间"},model:{value:t.addCoupon.end_time,callback:function(e){t.$set(t.addCoupon,"end_time",e)},expression:"addCoupon.end_time"}})],1)],1),t._v(" "),o("div",{staticClass:"goods"},[o("el-row",[o("el-col",{staticClass:"title"},[o("p",[t._v("选择适用商品")])])],1),t._v(" "),o("el-row",{staticClass:"pl20"},[o("p",{staticClass:"btn"},[o("el-button",{attrs:{type:"danger"},on:{click:function(e){t.selectVisible=!0}}},[t._v("选择商品")]),t._v(" "),o("el-button",{attrs:{type:"danger"},on:{click:t.addItemBomb}},[t._v("批量导入商品")])],1),t._v(" "),o("el-table",{staticClass:"table",attrs:{data:t.goodsList,border:"",align:"center","span-method":t.spanMethod}},[o("el-table-column",{attrs:{align:"center",label:"商品ID",prop:"item_id"}}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"商品编号",prop:"art_no"}}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"商品名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("a",{staticClass:"goods_url",attrs:{href:t.defaultUrl("item_id",e.row),target:"_blank"}},[t._v(t._s(e.row.title))])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"属性",prop:"spec_text"}}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"市场价（元）",prop:"market_price"}}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"标准售价（元）",prop:"sell_price"}}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"可售库存",prop:"store"}}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){return t.handleDelete(e.row)}}},[t._v("删除")])]}}])})],1)],1)],1),t._v(" "),o("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:t.addVisibleid},on:{"update:visible":function(e){t.addVisibleid=e}}},[o("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:t.goodsIds,callback:function(e){t.goodsIds=e},expression:"goodsIds"}}),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.addVisibleid=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.addGoodsById}},[t._v("确 定")])],1)],1),t._v(" "),o("select-goods",{attrs:{promotionType:t.type,promotionId:t.addCoupon.promotion_id.toString(),selectList:t.selectList,selectVisible:t.selectVisible},on:{"visible-change":t.handleVisible,"choose-submit":t.handleAdd}}),t._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("提交")]),t._v(" "),o("el-button",{on:{click:t.handleCancel}},[t._v("取消")])],1)],1)},staticRenderFns:[]};var m=o("C7Lr")(u,p,!1,function(t){o("bIXT")},"data-v-3ae011c3",null);e.default=m.exports}});
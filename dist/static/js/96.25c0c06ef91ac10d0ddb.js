webpackJsonp([96],{"A+cR":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("3cXf"),o=i.n(s),n=i("wSwi"),a=i("kvg+"),l=i("5P40"),r=i("6PaB"),d={data:function(){var t=this;return{typeMain:"GiftBuy",type:"gift",addVisibleid:!1,selectVisible:!1,addVisibleidGift:!1,selectVisibleGift:!1,goodsIds:"",goodsList:[],goodsIdsGift:"",goodsListGift:[],addCoupon:{promotion_name:"",start_time:"",end_time:"",items:[],arguments:{gifts:[]}},addRules:{promotion_name:[{required:!0,message:"请输入1~60个字符",trigger:"blur"},{min:1,max:60,message:"请输入1~60个字符",trigger:"blur"}],start_time:[{validator:function(e,i,s){i?(t.$refs.addCoupon.validateField("end_time"),s()):s(new Error("请选择活动开始时间"))},trigger:"blur"}],end_time:[{validator:function(e,i,s){i?i<t.addCoupon.start_time?s(new Error("活动结束时间需要大于活动开始时间")):s():s(new Error("请选择活动结束时间"))},trigger:"blur"}]}}},computed:{selectList:function(){var t=[];return this.goodsList.map(function(e){-1==t.indexOf(e.item_id)&&t.push(e.item_id)}),t},selectListGift:function(){var t=[];return this.goodsListGift.map(function(e){-1==t.indexOf(e.item_id)&&t.push(e.item_id)}),t},spanArr:function(){return Object(r.a)(this.goodsList)},spanArrGift:function(){return Object(r.a)(this.goodsListGift)}},methods:{addItemBomb:function(){this.addVisibleid=!0,this.goodsIds=""},addItemBombGift:function(){this.addVisibleidGift=!0,this.goodsIdsGift=""},addGoodsById:function(t){var e=this,i="goods"==t?"GiftBuy":"gift";(this.goodsIds||this.goodsIdsGift)&&a.a.importItemsById({item_id:this.goodsIds||this.goodsIdsGift,promotion_type:i,return_by:"sku"}).then(function(i){var s=i.data,o="";if(0!=s.itemList.length&&("goods"==t?e.goodsFilter(s.itemList):"gift"==t&&e.goodsFilterGift(s.itemList)),0!=s.inValidItems.length)for(var n=0;n<s.inValidItems.length;n++)o+="<p>异常商品ID:"+s.inValidItems[n]+"</p>";if(0!=s.unsatisfiedItems.length)for(var a=0;a<s.unsatisfiedItems.length;a++)o+="<p>参加了不可叠加的商品:"+s.unsatisfiedItems[a]+"</p>";o&&e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:o,type:"warning"})}),"goods"==t?(this.goodsIds="",this.addVisibleid=!1):"gift"==t&&(this.goodsIdsGift="",this.addVisibleidGift=!1)},goodsFilter:function(t){for(var e=0;e<t.length;e++){var i=!1;if(0!=this.goodsList.length)for(var s=0;s<this.goodsList.length;s++)t[e].sku_id==this.goodsList[s].sku_id&&(i=!0);i||this.goodsList.push(t[e])}var o=[];t.map(function(t){o.push(t.item_id)});for(var n=0;n<this.goodsList.length;n++)-1==o.indexOf(this.goodsList[n].item_id)&&(this.goodsList.splice(n,1),n--)},goodsFilterGift:function(t){for(var e=0;e<t.length;e++){var i=!1;if(0!=this.goodsListGift.length)for(var s=0;s<this.goodsListGift.length;s++)t[e].sku_id==this.goodsListGift[s].sku_id&&(i=!0);i||(this.goodsListGift.push(t[e]),this.$set(t[e],"edit",!1),this.$set(t[e],"quantity",1))}var o=[];t.map(function(t){o.push(t.item_id)});for(var n=0;n<this.goodsListGift.length;n++)-1==o.indexOf(this.goodsListGift[n].item_id)&&(this.goodsListGift.splice(n,1),n--)},handleVisible:function(t){this.selectVisible=t},handleVisibleGift:function(t){this.selectVisibleGift=t},handleAdd:function(t){var e=this;a.a.importItemsById({item_id:t,promotion_type:"GiftBuy",return_by:"sku"}).then(function(t){var i=t.data,s="";if(0!=i.itemList.length&&e.goodsFilter(i.itemList),0!=i.inValidItems.length)for(var o=0;o<i.inValidItems.length;o++)s+="<p>异常商品ID:"+i.inValidItems[o]+"</p>";if(0!=i.unsatisfiedItems.length)for(var n=0;n<i.unsatisfiedItems.length;n++)s+="<p>参加了不可叠加的商品:"+i.unsatisfiedItems[n]+"</p>";s&&e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:s,type:"warning"})})},handleAddGift:function(t){var e=this;a.a.importItemsById({item_id:t,promotion_type:"gift",return_by:"sku"}).then(function(t){var i=t.data,s="";if(0!=i.itemList.length&&e.goodsFilterGift(i.itemList),0!=i.inValidItems.length)for(var o=0;o<i.inValidItems.length;o++)s+="<p>异常商品ID:"+i.inValidItems[o]+"</p>";if(0!=i.unsatisfiedItems.length)for(var n=0;n<i.unsatisfiedItems.length;n++)s+="<p>参加了不可叠加的商品:"+i.unsatisfiedItems[n]+"</p>";s&&e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:s,type:"warning"})})},spanMethod:function(t){t.row,t.column;var e=t.rowIndex,i=t.columnIndex;if(0===i||1===i||2===i||7===i)return 1==this.spanArr[e]?{rowspan:0,colspan:0}:0==this.spanArr[e]?{rowspan:1,colspan:1}:{rowspan:this.spanArr[e],colspan:1}},handleEdit:function(t){this.goodsListGift.map(function(e){e.id==t.id&&(e.edit=!0)})},handleCheck:function(t){!/^(\d+)$/.test(t.quantity)||parseInt(t.quantity)>t.store||0==t.quantity?this.$message({showClose:!0,message:"仅限输入正整数，活动库存不得大于可售库存",type:"warning"}):t.edit=!1},handleDelete:function(t){this.goodsList=this.goodsList.filter(function(e){return e.item_id!=t.item_id})},handleDeleteGift:function(t){this.goodsListGift=this.goodsListGift.filter(function(e){return e.sku_id!=t.sku_id})},handleSubmit:function(){var t=this;this.$refs.addCoupon.validate(function(e){if(e){var i=[],s=[];t.goodsList.map(function(t){i.push({item_id:t.item_id,sku_id:t.id,price:t.promotion_price})}),t.goodsListGift.map(function(t){s.push({item_id:t.item_id,sku_id:t.id,quantity:t.quantity})}),t.addCoupon.items=o()(i),t.addCoupon.arguments.gifts=s,t.addCoupon.arguments=o()(t.addCoupon.arguments),l.a.createGiftBuy(t.addCoupon).then(function(e){0==e.code&&(t.$message({showClose:!0,message:"创建成功",type:"success"}),t.$router.push({name:"giftbuy"}))}),t.addCoupon.arguments=JSON.parse(t.addCoupon.arguments)}})},handleCancel:function(){this.$router.push({name:"giftbuy"})}},components:{SelectGoods:n.a}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-form",{ref:"addCoupon",attrs:{model:t.addCoupon,rules:t.addRules,"label-width":"120px"}},[i("div",{staticClass:"basic"},[i("el-form-item",{attrs:{label:"活动名称:",prop:"promotion_name"}},[i("el-input",{attrs:{placeholder:"活动名称"},model:{value:t.addCoupon.promotion_name,callback:function(e){t.$set(t.addCoupon,"promotion_name",e)},expression:"addCoupon.promotion_name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"活动开始时间:",prop:"start_time"}},[i("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"活动开始时间"},model:{value:t.addCoupon.start_time,callback:function(e){t.$set(t.addCoupon,"start_time",e)},expression:"addCoupon.start_time"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"活动结束时间:",prop:"end_time"}},[i("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"活动结束时间"},model:{value:t.addCoupon.end_time,callback:function(e){t.$set(t.addCoupon,"end_time",e)},expression:"addCoupon.end_time"}})],1)],1),t._v(" "),i("div",{staticClass:"goods"},[i("el-row",[i("el-col",{staticClass:"title"},[i("p",[t._v("选择适用商品")])])],1),t._v(" "),i("el-row",{staticClass:"pl20"},[i("p",{staticClass:"btn"},[i("el-button",{attrs:{type:"danger"},on:{click:function(e){t.selectVisible=!0}}},[t._v("选择商品")]),t._v(" "),i("el-button",{attrs:{type:"danger"},on:{click:t.addItemBomb}},[t._v("批量导入商品")])],1),t._v(" "),i("el-table",{staticClass:"table",attrs:{data:t.goodsList,border:"",align:"center","span-method":t.spanMethod}},[i("el-table-column",{attrs:{align:"center",label:"商品ID",prop:"item_id"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"商品编号",prop:"art_no"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"商品名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("a",{staticClass:"goods_url",attrs:{href:t.defaultUrl("item_id",e.row),target:"_blank"}},[t._v(t._s(e.row.title))])]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"属性",prop:"spec_text"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"市场价（元）",prop:"market_price"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"标准售价（元）",prop:"sell_price"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"可售库存",prop:"store"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.handleDelete(e.row)}}},[t._v("删除")])]}}])})],1)],1)],1),t._v(" "),i("div",{staticClass:"gifts"},[i("el-row",[i("el-col",{staticClass:"title"},[i("p",[t._v("选择赠品")])])],1),t._v(" "),i("el-row",{staticClass:"pl20"},[i("p",{staticClass:"btn"},[i("el-button",{attrs:{type:"danger"},on:{click:function(e){t.selectVisibleGift=!0}}},[t._v("选择商品")]),t._v(" "),i("el-button",{attrs:{type:"danger"},on:{click:t.addItemBombGift}},[t._v("批量导入商品")])],1),t._v(" "),i("el-table",{staticClass:"table",attrs:{data:t.goodsListGift,border:"",align:"center"}},[i("el-table-column",{attrs:{align:"center",label:"商品ID",prop:"item_id"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"商品编号",prop:"art_no"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"商品名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("a",{staticClass:"goods_url",attrs:{href:t.defaultUrl("item_id",e.row),target:"_blank"}},[t._v(t._s(e.row.title))])]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"市场价（元）",prop:"market_price"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"标准售价（元）",prop:"sell_price"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"可售库存",prop:"store"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"赠送数量/件"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{directives:[{name:"show",rawName:"v-show",value:!e.row.edit,expression:"!scope.row.edit"}]},[t._v(t._s(e.row.quantity))]),t._v(" "),i("el-input",{directives:[{name:"show",rawName:"v-show",value:e.row.edit,expression:"scope.row.edit"}],attrs:{size:"mini"},model:{value:e.row.quantity,callback:function(i){t.$set(e.row,"quantity",i)},expression:"scope.row.quantity"}})]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.row.edit,expression:"!scope.row.edit"}],attrs:{type:"text"},on:{click:function(i){return t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.row.edit,expression:"scope.row.edit"}],attrs:{type:"text"},on:{click:function(i){return t.handleCheck(e.row)}}},[t._v("保存")]),t._v(" "),i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.handleDeleteGift(e.row)}}},[t._v("删除")])]}}])})],1)],1)],1),t._v(" "),i("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:t.addVisibleid},on:{"update:visible":function(e){t.addVisibleid=e}}},[i("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:t.goodsIds,callback:function(e){t.goodsIds=e},expression:"goodsIds"}}),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.addVisibleid=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addGoodsById("goods")}}},[t._v("确 定")])],1)],1),t._v(" "),i("select-goods",{attrs:{promotionType:t.typeMain,selectVisible:t.selectVisible,selectList:t.selectList},on:{"visible-change":t.handleVisible,"choose-submit":t.handleAdd}}),t._v(" "),i("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:t.addVisibleidGift},on:{"update:visible":function(e){t.addVisibleidGift=e}}},[i("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:t.goodsIdsGift,callback:function(e){t.goodsIdsGift=e},expression:"goodsIdsGift"}}),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.addVisibleidGift=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addGoodsById("gift")}}},[t._v("确 定")])],1)],1),t._v(" "),i("select-goods",{attrs:{subType:"gift",promotionType:t.type,selectVisible:t.selectVisibleGift,selectList:t.selectListGift},on:{"visible-change":t.handleVisibleGift,"choose-submit":t.handleAddGift}}),t._v(" "),i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("提交")]),t._v(" "),i("el-button",{on:{click:t.handleCancel}},[t._v("取消")])],1)],1)},staticRenderFns:[]};var c=i("C7Lr")(d,u,!1,function(t){i("mlb4")},"data-v-116bfffa",null);e.default=c.exports},mlb4:function(t,e){}});
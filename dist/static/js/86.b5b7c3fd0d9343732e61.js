webpackJsonp([86],{"3vX6":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("3cXf"),s=o.n(i),a=o("wSwi"),n=o("kvg+"),r=o("W6kE"),l=o("6PaB"),d={data:function(){var e=this;return{canclick:!1,type:"SecKill",addVisibleid:!1,selectVisible:!1,goodsIds:"",goodsList:[],commitData:{},addCoupon:{promotion_name:"",release_time:"",start_time:"",end_time:"",items:[]},addRules:{promotion_name:[{required:!0,message:"请输入1~60个字符",trigger:"blur"},{min:1,max:60,message:"请输入1~60个字符",trigger:"blur"}],start_time:[{validator:function(t,o,i){o?(e.$refs.addCoupon.validateField("end_time"),i()):i(new Error("请选择活动开始时间"))},trigger:"blur"}],end_time:[{validator:function(t,o,i){o?o<e.addCoupon.start_time?i(new Error("活动结束时间需要大于活动开始时间")):i():i(new Error("请选择活动结束时间"))},trigger:"blur"}]}}},computed:{selectList:function(){var e=[];return this.goodsList.map(function(t){-1==e.indexOf(t.item_id)&&e.push(t.item_id)}),e},spanArr:function(){return Object(l.a)(this.goodsList)}},methods:{addItemBomb:function(){this.addVisibleid=!0,this.goodsIds=""},addGoodsById:function(){var e=this;this.goodsIds&&n.a.importItemsById({item_id:this.goodsIds,promotion_type:"SecKill",return_by:"sku"}).then(function(t){var o=t.data,i="";if(0!=o.itemList.length&&e.goodsFilter(o.itemList),0!=o.inValidItems.length)for(var s=0;s<o.inValidItems.length;s++)i+="<p>异常商品ID:"+o.inValidItems[s]+"</p>";if(0!=o.unsatisfiedItems.length)for(var a=0;a<o.unsatisfiedItems.length;a++)i+="<p>参加了不可叠加的商品:"+o.unsatisfiedItems[a]+"</p>";i&&e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:i,type:"warning"})}),this.goodsIds="",this.addVisibleid=!1},goodsFilter:function(e){for(var t=0;t<e.length;t++){var o=!1;if(0!=this.goodsList.length)for(var i=0;i<this.goodsList.length;i++)e[t].sku_id==this.goodsList[i].sku_id&&(o=!0);o||(this.goodsList.push(e[t]),this.$set(e[t],"edit",!1),this.$set(e[t],"price",""),this.$set(e[t],"promotion_price",""))}var s=[];e.map(function(e){s.push(e.item_id)});for(var a=0;a<this.goodsList.length;a++)-1==s.indexOf(this.goodsList[a].item_id)&&(this.goodsList.splice(a,1),a--)},handleVisible:function(e){this.selectVisible=e},handleAdd:function(e){var t=this;n.a.importItemsById({item_id:e,promotion_type:"SecKill",return_by:"sku"}).then(function(e){var o=e.data,i="";if(0!=o.itemList.length&&t.goodsFilter(o.itemList),0!=o.inValidItems.length)for(var s=0;s<o.inValidItems.length;s++)i+="<p>异常商品ID:"+o.inValidItems[s]+"</p>";if(0!=o.unsatisfiedItems.length)for(var a=0;a<o.unsatisfiedItems.length;a++)i+="<p>参加了不可叠加的商品:"+o.unsatisfiedItems[a]+"</p>";i&&t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:i,type:"warning"})})},spanMethod:function(e){e.row,e.column;var t=e.rowIndex,o=e.columnIndex;if(0===o||1===o||2===o||7===o)return 1==this.spanArr[t]?{rowspan:0,colspan:0}:0==this.spanArr[t]?{rowspan:1,colspan:1}:{rowspan:this.spanArr[t],colspan:1}},handleEdit:function(e){this.goodsList.map(function(t){t.item_id==e.item_id&&(t.edit=!0)})},handleCheck:function(e){var t=this,o=/^(\d+)$|^(\d+\.\d+)$/,i=/^(\d+)$/,s=!0;this.goodsList.map(function(a){a.item_id==e.item_id&&(a.price=parseFloat(a.price),a.promotion_store=parseInt(a.promotion_store),!o.test(a.price)||a.price>=parseFloat(a.sell_price)||0==a.price?(t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"仅限输入正数，保留两位小数，金额需小于标准售价",type:"warning"}),s=!1):a.price=parseFloat(a.price).toFixed(2),(!i.test(a.promotion_store)||parseFloat(a.promotion_store)>parseFloat(a.store))&&(t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"仅限输入正整数，活动库存不得大于可售库存",type:"warning"}),s=!1))}),this.goodsList.map(function(t){t.item_id==e.item_id&&s&&(t.edit=!1)})},handleDelete:function(e){this.goodsList=this.goodsList.filter(function(t){return t.item_id!=e.item_id})},handleSubmit:function(){var e=this;this.$refs.addCoupon.validate(function(t){if(t){var o=[];e.goodsList.map(function(e){o.push({item_id:e.item_id,sku_id:e.id,price:e.price,store:e.promotion_store})}),e.addCoupon.items=s()(o),e.canclick=!0,setTimeout(function(){e.canclick=!1},3e3),r.a.createSeckill(e.addCoupon).then(function(t){0==t.code&&(e.$message({showClose:!0,message:"创建成功",type:"success"}),e.$router.push({name:"seckill"}))})}})},handleCancel:function(){this.$router.push({name:"seckill"})}},components:{SelectGoods:a.a}},c={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-form",{ref:"addCoupon",attrs:{model:e.addCoupon,rules:e.addRules,"label-width":"120px"}},[o("div",{staticClass:"basic"},[o("el-form-item",{attrs:{label:"活动名称:",prop:"promotion_name"}},[o("el-input",{attrs:{placeholder:"活动名称"},model:{value:e.addCoupon.promotion_name,callback:function(t){e.$set(e.addCoupon,"promotion_name",t)},expression:"addCoupon.promotion_name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"每人每件限购:"}},[o("span",[e._v("1件")])]),e._v(" "),o("el-form-item",{attrs:{label:"活动发布时间:",prop:"release_time"}},[o("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"活动发布时间"},model:{value:e.addCoupon.release_time,callback:function(t){e.$set(e.addCoupon,"release_time",t)},expression:"addCoupon.release_time"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"活动开始时间:",prop:"start_time"}},[o("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"活动开始时间"},model:{value:e.addCoupon.start_time,callback:function(t){e.$set(e.addCoupon,"start_time",t)},expression:"addCoupon.start_time"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"活动结束时间:",prop:"end_time"}},[o("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"活动结束时间"},model:{value:e.addCoupon.end_time,callback:function(t){e.$set(e.addCoupon,"end_time",t)},expression:"addCoupon.end_time"}})],1)],1),e._v(" "),o("div",{staticClass:"goods"},[o("el-row",[o("el-col",{staticClass:"title"},[o("p",[e._v("选择适用商品")])])],1),e._v(" "),o("el-row",{staticClass:"pl20"},[o("p",{staticClass:"btn"},[o("el-button",{attrs:{type:"danger"},on:{click:function(t){e.selectVisible=!0}}},[e._v("选择商品")]),e._v(" "),o("el-button",{attrs:{type:"danger"},on:{click:e.addItemBomb}},[e._v("批量导入商品")])],1),e._v(" "),o("el-table",{staticClass:"table",attrs:{data:e.goodsList,border:"",align:"center","span-method":e.spanMethod}},[o("el-table-column",{attrs:{align:"center",label:"商品ID",prop:"item_id"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("a",{staticClass:"goods_url",attrs:{href:e.defaultUrl("item_id",t.row),target:"_blank"}},[e._v(e._s(t.row.title))])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"属性",prop:"spec_text"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"标准售价（元）",prop:"sell_price"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"活动价（元）"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{directives:[{name:"show",rawName:"v-show",value:!t.row.edit,expression:"!scope.row.edit"}]},[e._v(e._s(t.row.price))]),e._v(" "),o("el-input",{directives:[{name:"show",rawName:"v-show",value:t.row.edit,expression:"scope.row.edit"}],attrs:{size:"mini"},model:{value:t.row.price,callback:function(o){e.$set(t.row,"price",o)},expression:"scope.row.price"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"总库存",prop:"store"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"活动库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{directives:[{name:"show",rawName:"v-show",value:!t.row.edit,expression:"!scope.row.edit"}]},[e._v(e._s(t.row.promotion_store))]),e._v(" "),o("el-input",{directives:[{name:"show",rawName:"v-show",value:t.row.edit,expression:"scope.row.edit"}],attrs:{size:"mini"},model:{value:t.row.promotion_store,callback:function(o){e.$set(t.row,"promotion_store",o)},expression:"scope.row.promotion_store"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.edit,expression:"!scope.row.edit"}],attrs:{type:"text"},on:{click:function(o){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),o("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.edit,expression:"scope.row.edit"}],attrs:{type:"text"},on:{click:function(o){return e.handleCheck(t.row)}}},[e._v("保存")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:e.addVisibleid},on:{"update:visible":function(t){e.addVisibleid=t}}},[o("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:e.goodsIds,callback:function(t){e.goodsIds=t},expression:"goodsIds"}}),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.addVisibleid=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.addGoodsById}},[e._v("确 定")])],1)],1),e._v(" "),o("select-goods",{attrs:{promotionType:e.type,selectVisible:e.selectVisible,selectList:e.selectList},on:{"visible-change":e.handleVisible,"choose-submit":e.handleAdd}}),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-button",{attrs:{type:"primary",disabled:e.canclick},on:{click:e.handleSubmit}},[e._v("提交")]),e._v(" "),o("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var p=o("C7Lr")(d,c,!1,function(e){o("Hige")},"data-v-300d5fd7",null);t.default=p.exports},Hige:function(e,t){}});
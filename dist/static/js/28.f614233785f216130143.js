webpackJsonp([28],{"0C5w":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i("hRKE"),o=i.n(l),n=i("1G+u"),s=i("ypf/"),a={data:function(){var e=this;return{loading:!1,centerDialogVisible:!1,list:[],info_list:[],form:{name:"",id:"",privilege_list:[]},columns:[{label:"角色名称",field:"name",align:"center"},{label:"操作",align:"center",actions:[{label:"编辑",type:"primary",size:"mini",click:function(t,i){e.openRole({role_id:i.role_id}),e.form.id=i.id}},{label:"删除",type:"danger",size:"mini",click:function(t,i){s.a.delRole({id:i.id}).then(function(t){0===t.code&&(e.$message({type:"success",message:"删除成功！"}),e.getRoleList())})}}]}],checked_info_list:[],defaultProps:{children:"children",label:"label"}}},methods:{getRoleList:function(){var e=this;s.a.getRoleList().then(function(t){if(""!=e.list)for(var i in e.list=[],t.data)e.list.push(t.data[i]);else for(var i in t.data)e.list.push(t.data[i])})},getRoleInfo:function(e){var t=this;s.a.getRoleInfo(e).then(function(e){var i=e.data.privilege_list;t.form.name=e.data.name;var l=[];if(i.length>0)for(var n in i)l.push(i[n]);t.info_list=l;var s=[];for(var n in t.checked_info_list=[],t.info_list)for(var a in t.info_list[n].children)for(var r in t.info_list[n].children[a])if("object"==o()(t.info_list[n].children[a][r]))for(var c in t.info_list[n].children[a][r])t.info_list[n].children[a][r][c].is_selected&&s.push(t.info_list[n].children[a][r][c].id.toString());t.checked_info_list=s})},addRole:function(){this.$router.push({name:"addRole"})},updateRole:function(e){var t=this;s.a.updateRole(e).then(function(e){t.centerDialogVisible=!1,t.$message({message:"编辑成功",type:"success"})}).catch(function(e){this.centerDialogVisible=!1,this.$message({message:"编辑失败",type:"error"})})},openRole:function(e){this.centerDialogVisible=!0,this.getRoleInfo(e)},getCheckedKeys:function(){var e=this.$refs.tree.getCheckedKeys();if(""!=this.form.privilege_list)for(var t in this.form.privilege_list=[],e)null!=e[t]&&this.form.privilege_list.push(e[t]);else for(var t in e)null!=e[t]&&this.form.privilege_list.push(e[t]);this.updateRole(this.form)}},components:{TableView:n.a},created:function(){this.getRoleList()}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"manage"},[i("el-row",[i("el-col",{attrs:{span:6}},[i("el-button",{attrs:{type:"primary"},on:{click:e.addRole}},[e._v("添加角色")])],1)],1),e._v(" "),i("el-tabs",[i("table-view",{attrs:{loading:e.loading,columns:e.columns,pageList:e.list}})],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑",visible:e.centerDialogVisible,width:"50%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[i("div",[i("el-tree",{ref:"tree",attrs:{data:e.info_list,"show-checkbox":"","node-key":"id","default-expanded-keys":e.checked_info_list,"default-checked-keys":e.checked_info_list,props:e.defaultProps}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.getCheckedKeys}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var c=i("C7Lr")(a,r,!1,function(e){i("c5h0")},"data-v-2ac532d8",null);t.default=c.exports},c5h0:function(e,t){},"ypf/":function(e,t,i){"use strict";var l=i("2AkA");t.a={getRoleList:function(){return Object(l.a)({method:"get",url:"/trmall/shop/getRoleList"})},delRole:function(e){return Object(l.a)({method:"post",url:"/trmall/shop/deleteRole",data:e})},getRoleInfo:function(e){return Object(l.a)({method:"get",url:"/trmall/shop/getRoleInfo",params:e})},getPrivilegeList:function(){return Object(l.a)({method:"get",url:"/trmall/shop/getPrivilegeList"})},createRole:function(e){return Object(l.a)({method:"post",url:"/trmall/shop/createRole",data:e})},updateRole:function(e){return Object(l.a)({method:"post",url:"/trmall/shop/updateRole",data:e})}}}});
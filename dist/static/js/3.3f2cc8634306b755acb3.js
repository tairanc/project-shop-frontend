webpackJsonp([3],{"53is":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("3cXf"),s=i.n(a),o=i("S7CR"),l=i("1G+u"),n=i("wSwi"),r=i("VXZc"),c=i("6PaB"),d=i("NcNL"),u=i.n(d),p=i("wJ7o"),m=i.n(p),h={data:function(){return{statusFirst:!1,isfullreduce:!0,detailInfo:{promotion_id:"",page:1,page_size:20,item_search:null},backData:{},loading:!1,promotionType:"FullDiscount",addVisibleid:!1,selectVisible:!1,goodsIds:"",itemList:[],itemListAll:[],total:0,goodsVisible:!1,couponInfo:{coupon_id:void 0},couponDetail:{extend:{}},columns:[{label:"商品ID",field:"item_id",align:"center"},{label:"商品名称",field:"title",align:"center"},{label:"属性",field:"spec_text",align:"center"},{label:"市场价（元）",field:"market_price",align:"center"},{label:"标准售价（元）",field:"sell_price",align:"center"},{label:"可售库存",field:"store",align:"center"},{label:"销量",field:"sales",align:"center"}]}},methods:{getAllDetail:function(e){var t=this,i=JSON.parse(s()(e));null!=i.item_search&&i.item_search.length>0?t.downFileData(this.itemList):(i.page_size=-1,o.a.getShopcoupon(i,this.isfullreduce).then(function(e){t.downFileData(e.data.itemList.list)}))},downFileData:function(e){e.length<1||(this.itemListAll=e,setTimeout(function(){var e=m.a.utils.table_to_book(document.querySelector("#export-form")),t=m.a.write(e,{bookType:"xlsx",bookSST:!0,type:"array"});try{u.a.saveAs(new Blob([t],{type:"application/octet-stream"}),"商品列表.xlsx")}catch(e){"undefined"!=typeof console&&console.log(e,t)}return t},1e3))},getDetail:function(e){var t=this;o.a.getShopcoupon(e,this.isfullreduce).then(function(e){t.backData=e.data,t.itemList=e.data.itemList.list,t.total=e.data.itemList.total_count})},closeCouponItem:function(e,t){var i=this;this.$confirm("确定关闭该商品的活动状态？","关闭提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.a.closeCouponItem({promotion_id:e,item_id:t},i.isfullreduce).then(function(e){e.data?(i.$message({showClose:!0,message:"商品关闭成功",type:"success",duration:1e3}),i.getDetail(i.detailInfo)):i.$message({showClose:!0,message:e.message,type:"error",duration:1e3})})}).catch(function(){i.$message({type:"info",message:"已取消关闭商品"})})},searchItem:function(){this.detailInfo.page=1,this.getDetail(this.detailInfo)},resetSearch:function(){this.detailInfo.page=1,this.detailInfo.item_search="",this.getDetail(this.detailInfo)},exportForm:function(){this.getAllDetail(this.detailInfo),this.$message({showClose:!0,message:"导出成功",type:"success"})},spanMethod:function(e){e.row,e.column;var t=e.rowIndex,i=e.columnIndex;if(0===i||1===i||2===i||7===i)return 1==this.spanArr[t]?{rowspan:0,colspan:0}:0==this.spanArr[t]?{rowspan:1,colspan:1}:{rowspan:this.spanArr[t],colspan:1}},handleEdit:function(e){this.itemList.map(function(t){t.item_id==e.item_id&&(t.edit=!0)})},addTicketGoods:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",i=[],a=[];this.itemList.map(function(e,t){0!=e.status&&-1==a.indexOf(e.item_id)&&a.push(e.item_id)});("splice"==t?this.goodsIds.split(","):this.goodsIds).map(function(e,t){-1==a.indexOf(e)&&i.push({item_id:e})});i.length<1||o.a.appendItems({promotion_id:this.couponInfo.coupon_id,items:i},this.isfullreduce).then(function(t){if(0!=t.data.fail){for(var i="",a=t.data.message,s=t.data.message.length,o=0;o<s;o++)i+="<p>"+a[o]+"</p>";e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:i,type:"warning"})}else e.$message({showClose:!0,message:"添加商品成功",type:"success"}),e.addVisibleid=!1,e.getDetail(e.detailInfo)},function(t){e.$message({showClose:!0,message:t.message,type:"warning"})})},addItemBomb:function(){this.addVisibleid=!0,this.goodsIds=""},backList:function(){var e=this.isfullreduce?"reducebreak":"reducefull";this.$router.push({name:e})},sizeChange:function(e){this.detailInfo.page_size=e,this.getDetail(this.detailInfo)},pageChange:function(e){this.detailInfo.page=e,this.getDetail(this.detailInfo)},handleVisible:function(e){this.selectVisible=e},handleAdd:function(e){this.goodsIds=e,this.addTicketGoods()}},components:{TableView:l.a,PaginationView:r.a,SelectGoods:n.a},computed:{spanArr:function(){return Object(c.a)(this.itemList)}},created:function(){this.isfullreduce="reduceBreakDetail"===this.$route.name,this.promotionType="reduceBreakDetail"===this.$route.name?"FullDiscount":"FullMinus",30!=this.$route.query.status?this.statusFirst=!0:this.statusFirst=!1,this.couponInfo.coupon_id=this.$route.query.id,this.detailInfo.promotion_id=this.$route.query.id,this.getDetail(this.detailInfo)}},f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"reducedetail"},[i("div",{staticClass:"content"},[i("h3",[e._v("活动信息")]),e._v(" "),e.backData!={}?i("el-row",[i("el-col",[i("p",[e._v("活动名称： "+e._s(e.backData.name))])]),e._v(" "),i("el-col",[i("p",[e._v("活动规则： "+e._s(e.backData.ruleStr))])]),e._v(" "),i("el-col",[i("p",[e._v("活动创建时间： "+e._s(e.backData.created_at))])]),e._v(" "),i("el-col",[i("p",[e._v("活动开始时间： "+e._s(e.backData.start_time))])]),e._v(" "),i("el-col",[i("p",[e._v("活动结束时间： "+e._s(e.backData.end_time))])])],1):e._e(),e._v(" "),i("el-row",[i("h3",[e._v("商品信息")]),e._v(" "),i("el-col",[i("el-button",{on:{click:e.exportForm}},[e._v("导出报表")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.selectVisible=!0}}},[e._v("选择商品")]),e._v(" "),i("el-button",{on:{click:e.addItemBomb}},[e._v("批量导入商品")]),e._v(" "),i("el-input",{staticClass:"item_search",attrs:{placeholder:"请输入商品 ID 进行搜索",clearable:""},model:{value:e.detailInfo.item_search,callback:function(t){e.$set(e.detailInfo,"item_search",t)},expression:"detailInfo.item_search\t"}}),e._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchItem}},[e._v("搜索")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.resetSearch}},[e._v("重置")])],1),e._v(" "),i("el-col",{staticClass:"mt20",attrs:{span:24}},[i("el-table",{staticClass:"table",attrs:{data:e.itemList,border:"",align:"center","span-method":e.spanMethod,id:"exportformtable"}},[i("el-table-column",{attrs:{align:"center",label:"商品ID",prop:"item_id"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("a",{staticClass:"goods_url",attrs:{href:e.defaultUrl("item_id",t.row),target:"_blank"}},[e._v(e._s(t.row.title))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"属性",prop:"spec_text"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"市场价（元）"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{directives:[{name:"show",rawName:"v-show",value:!t.row.edit,expression:"!scope.row.edit"}]},[e._v(e._s(t.row.market_price))]),e._v(" "),i("el-input",{directives:[{name:"show",rawName:"v-show",value:t.row.edit,expression:"scope.row.edit"}],attrs:{size:"mini"},model:{value:t.row.market_price,callback:function(i){e.$set(t.row,"market_price",i)},expression:"scope.row.market_price"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"标准售价（元）",prop:"sell_price"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"可售库存",prop:"store"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"销量",prop:"sales"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.statusFirst?i("el-button",{attrs:{type:"info",size:"mini",disabled:""}},[e._v("关闭")]):0!=t.row.status&&0==e.statusFirst?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.closeCouponItem(e.backData.id,t.row.item_id)}}},[e._v("关闭")]):i("el-button",{attrs:{type:"info",disabled:"",size:"mini"}},[e._v("已关闭")])]}}])})],1),e._v(" "),i("pagination-view",{attrs:{currentPage:e.detailInfo.page,total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),e._v(" "),i("el-tabs",{attrs:{id:"export-form"}},[i("table-view",{attrs:{loading:e.loading,columns:e.columns,pageList:e.itemListAll}})],1)],1)],1)],1),e._v(" "),i("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:e.addVisibleid},on:{"update:visible":function(t){e.addVisibleid=t}}},[i("el-form",[i("el-form-item",[i("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:e.goodsIds,callback:function(t){e.goodsIds=t},expression:"goodsIds"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.addVisibleid=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addTicketGoods("splice")}}},[e._v("确 定")])],1)],1),e._v(" "),i("select-goods",{attrs:{selectVisible:e.selectVisible,promotionType:e.promotionType},on:{"visible-change":e.handleVisible,"choose-submit":e.handleAdd}}),e._v(" "),i("el-row",{staticClass:"mt40",attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"primary"},on:{click:e.backList}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var _=i("C7Lr")(h,f,!1,function(e){i("v6Mv")},"data-v-d7de4e28",null);t.default=_.exports},v6Mv:function(e,t){}});
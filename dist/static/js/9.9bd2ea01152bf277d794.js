webpackJsonp([9],{"7Xp+":function(e,t){},IHur:function(e,t,a){var i=a("A2+p"),o=a("H5bT");a("Y2FG")("keys",function(){return function(e){return o(i(e))}})},Y2FG:function(e,t,a){var i=a("2AZ7"),o=a("/KQr"),s=a("D86D");e.exports=function(e,t){var a=(o.Object||{})[e]||Object[e],l={};l[e]=t(a),i(i.S+i.F*s(function(){a(1)}),"Object",l)}},ZLEe:function(e,t,a){e.exports={default:a("m5p0"),__esModule:!0}},bIQT:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("4YfN"),o=a.n(i),s=a("ZLEe"),l=a.n(s),n=a("3cXf"),d=a.n(n),r=a("4Xi4"),p=a.n(r),c=a("1G+u"),u=a("wSwi"),m=a("kvg+"),_={data:function(){var e=this,t=function(e,t,a){t?p()(t)&&t>=1&&t<=999999999?a():a(new Error("请输入1~9个字符，仅限正整数")):a("请输入1~9个字符，仅限正整数")};return{showBtnBatch:!1,checkAll:!1,loading:!1,addVisibleid:!1,selectVisible:!1,goodsIds:"",itemList:[],pageInfo:{page:1,page_size:-1,coupon_id:void 0},commitData:{},addCoupon:{is_set_expiry_date:"0",expiry_date:"",coupon_id:void 0,coupon_name:"",limit_money:"",deduct_money:"",send_quantity:"",user_obtain_limit:"",is_show:"",applicable_platform:[],is_check_all:0,item_ids:"",obtain_start_time:"",obtain_end_time:"",use_start_time:"",use_end_time:""},columns:[{label:"商品ID",field:"id",align:"center"},{label:"商品名称",align:"center",isGood:1},{label:"标准售价(元)",field:"sell_price",align:"center"},{label:"操作",align:"center",actions:[{label:"删除",type:"primary",size:"mini",click:function(t,a){e.deleteGoods(a.id)}}]}],addRules:{coupon_name:[{required:!0,message:"请输入1~60个字符",trigger:"blur"},{min:1,max:60,message:"请输入1~60个字符",trigger:"blur"}],limit_money:[{validator:function(e,t,a){t?p()(t)&&t>=1&&t<=999999999?a():a(new Error("请输入1~9个字符，仅限正整数")):a()},trigger:"blur"}],deduct_money:[{required:!0,validator:t,trigger:"blur"}],send_quantity:[{required:!0,validator:t,trigger:"blur"}],expiry_date:[{required:!0,validator:t,trigger:"blur"}],user_obtain_limit:[{required:!0,validator:function(e,t,a){t?p()(t)&&t>=1&&t<=99999?a():a(new Error("请输入1~5个字符，仅限正整数")):a("请输入1~5个字符，仅限正整数")},trigger:"blur"}],is_show:[{required:!0,message:"请选择是否显示入口",trigger:"change"}],applicable_platform:[{required:!0,message:"请选择适用平台",trigger:"change"}],is_check_all:[{required:!0,message:"请选择是否全选商品",trigger:"change"}],obtain_start_time:[{required:!0,message:"请选择领取开始时间",trigger:"change"}],obtain_end_time:[{required:!0,message:"请选择领取结束时间",trigger:"change"}],use_start_time:[{required:!0,message:"请选择使用开始时间",trigger:"change"}],use_end_time:[{required:!0,message:"请选择使用结束时间",trigger:"change"}]}}},computed:{selectList:function(){var e=[];return this.itemList.map(function(t){e.push(t.id)}),e}},methods:{handleCheckAllChange:function(e){this.addCoupon.applicable_platform=e?["WX","APP","WAP","PC"]:[]},platformChange:function(e){this.checkAll=4==e.length},addItemBomb:function(){this.addVisibleid=!0,this.goodsIds=""},addGoodsById:function(){var e=this;if(this.goodsIds){var t=this,a=JSON.parse(d()(this.goodsIds));if(0==this.showBtnBatch){var i=[];-1!=this.goodsIds.indexOf(",")?i=this.goodsIds.split(","):-1!=this.goodsIds.indexOf("，")?i=this.goodsIds.split("，"):i.push(this.goodsIds),this.itemList.map(function(e,t){-1==i.indexOf(e.item_id)&&i.push(e.item_id)}),a=i.join(",")}m.a.importItemsById({item_id:a}).then(function(a){var i=a.data,o="";if(0!=i.itemList.length&&t.goodsFilter(i.itemList),0!=i.inValidItems.length)for(var s=0;s<i.inValidItems.length;s++)o+="<p>异常商品ID:"+i.inValidItems[s]+"</p>";if(0!=i.unsatisfiedItems.length)for(var l=0;l<i.unsatisfiedItems.length;l++)o+="<p>参加了不可叠加的商品:"+i.unsatisfiedItems[l]+"</p>";o&&e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:o,type:"warning"})})}this.goodsIds="",this.addVisibleid=!1},goodsFilter:function(e){for(var t=0;t<e.length;t++){var a=!1;if(0!=this.itemList.length)for(var i=0;i<this.itemList.length;i++)e[t].id==this.itemList[i].id&&(a=!0);a||this.itemList.push(e[t])}var o=[];e.map(function(e){o.push(e.id)});for(var s=0;s<this.itemList.length;s++)-1==o.indexOf(this.itemList[s].id)&&(this.itemList.splice(s,1),s--)},deleteGoods:function(e){this.itemList=this.itemList.filter(function(t){return t.id!=e})},backList:function(){this.$router.push({name:"ticket"})},getEditcoupon:function(e){var t=this,a=this;m.a.getShopcoupon({coupon_id:e}).then(function(e){var i=e.data;if(l()(a.addCoupon).forEach(function(e){a.addCoupon[e]=i[e]||i.extend[e]}),a.addCoupon.coupon_name=i.name,a.addCoupon.is_show=i.is_show.toString(),a.addCoupon.is_set_expiry_date=i.is_set_expiry_date+"",a.addCoupon.is_check_all=parseInt(JSON.parse(i.extend.arguments).is_check_all),a.addCoupon.is_set_expiry_date=parseInt(JSON.parse(i.extend.arguments).is_set_expiry_date)+"",a.addCoupon.applicable_platform=t.addCoupon.applicable_platform.split(","),-1!=a.addCoupon.applicable_platform.indexOf("ALL"))a.addCoupon.applicable_platform=["WX","APP","WAP","PC"],a.checkAll=!0;else{var o=a.addCoupon.applicable_platform.indexOf("XCX");-1!=o&&a.addCoupon.applicable_platform.splice(o,1)}t.showBtnBatch=1!=e.data.status})},getCouponAppliedItems:function(e){var t=this;m.a.getCouponAppliedItems(e).then(function(e){0==e.code&&(t.itemList=e.data.list)})},commitCoupon:function(){var e=this,t=[];if(this.itemList.forEach(function(e){t.push(e.id)}),this.addCoupon.item_ids=t.toString(),this.commitData=o()({},this.addCoupon),4==this.commitData.applicable_platform.length&&(this.commitData.applicable_platform=["ALL"]),this.commitData.is_show=parseInt(this.commitData.is_show),""==this.commitData.limit_money&&(this.commitData.limit_money=0),""==this.addCoupon.item_ids)this.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"请选择优惠券商品～",type:"warning"}),this.addCoupon.is_set_expiry_date;else if(this.addCoupon.limit_money&&this.addCoupon.limit_money<this.addCoupon.deduct_money)this.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"优惠金额需小于门槛金额",type:"warning"}),this.addCoupon.is_set_expiry_date;else{var a=this;this.$refs.addCoupon.validate(function(t){if(!t)return!1;1==a.commitData.is_set_expiry_date&&(delete a.commitData.use_start_time,delete a.commitData.use_end_time),m.a.updateCounpon(a.commitData).then(function(t){0==t.code?(e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"优惠券保存成功",type:"success"}),e.$router.push({name:"ticket"})):(e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:t.message,type:"warning"}),e.addCoupon.is_set_expiry_date)})})}},handleVisible:function(e){this.selectVisible=e},handleAdd:function(e){var t=this;m.a.importItemsById({item_id:e}).then(function(e){var a=e.data,i="";if(0!=a.itemList.length&&t.goodsFilter(a.itemList),0!=a.inValidItems.length)for(var o=0;o<a.inValidItems.length;o++)i+="<p>异常商品ID:"+a.inValidItems[o]+"</p>";if(0!=a.unsatisfiedItems.length)for(var s=0;s<a.unsatisfiedItems.length;s++)i+="<p>参加了不可叠加的商品:"+a.unsatisfiedItems[s]+"</p>";i&&t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:i,type:"warning"})})}},components:{TableView:c.a,SelectGoods:u.a},created:function(){this.addCoupon.coupon_id=this.$route.query.id,this.pageInfo.coupon_id=this.$route.query.id,this.getEditcoupon(this.pageInfo.coupon_id),this.getCouponAppliedItems(this.pageInfo)}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"addCoupon",attrs:{model:e.addCoupon,rules:e.addRules,"label-width":"120px"}},[a("div",{staticClass:"basic"},[a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"优惠券名称:",prop:"coupon_name"}},[a("el-input",{attrs:{placeholder:"优惠券名称"},model:{value:e.addCoupon.coupon_name,callback:function(t){e.$set(e.addCoupon,"coupon_name",t)},expression:"addCoupon.coupon_name"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"门槛金额:",prop:"limit_money"}},[a("el-input",{attrs:{placeholder:"门槛金额"},model:{value:e.addCoupon.limit_money,callback:function(t){e.$set(e.addCoupon,"limit_money",e._n(t))},expression:"addCoupon.limit_money"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("p",{staticClass:"tips"},[e._v("无门槛可不填，满足优惠金额即可使用")])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"优惠金额:",prop:"deduct_money"}},[a("el-input",{attrs:{placeholder:"优惠金额"},model:{value:e.addCoupon.deduct_money,callback:function(t){e.$set(e.addCoupon,"deduct_money",e._n(t))},expression:"addCoupon.deduct_money"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"发放数量:",prop:"send_quantity"}},[a("el-input",{attrs:{placeholder:"发放数量"},model:{value:e.addCoupon.send_quantity,callback:function(t){e.$set(e.addCoupon,"send_quantity",e._n(t))},expression:"addCoupon.send_quantity"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"每人每张限领:",prop:"user_obtain_limit"}},[a("el-input",{attrs:{placeholder:"每人每张限领"},model:{value:e.addCoupon.user_obtain_limit,callback:function(t){e.$set(e.addCoupon,"user_obtain_limit",e._n(t))},expression:"addCoupon.user_obtain_limit"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"是否显示入口:",prop:"is_show"}},[a("el-radio-group",{model:{value:e.addCoupon.is_show,callback:function(t){e.$set(e.addCoupon,"is_show",t)},expression:"addCoupon.is_show"}},[a("el-radio",{attrs:{label:"1"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"0"}},[e._v("否")])],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12,offset:1}},[a("el-form-item",{attrs:{label:"使用平台:",prop:"applicable_platform"}},[a("el-checkbox",{staticStyle:{float:"left","margin-right":"20px"},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),a("el-checkbox-group",{on:{change:e.platformChange},model:{value:e.addCoupon.applicable_platform,callback:function(t){e.$set(e.addCoupon,"applicable_platform",t)},expression:"addCoupon.applicable_platform"}},[a("el-checkbox",{attrs:{label:"WX"}},[e._v("微信")]),e._v(" "),a("el-checkbox",{attrs:{label:"APP"}},[e._v("APP")]),e._v(" "),a("el-checkbox",{attrs:{label:"WAP"}},[e._v("移动端网页")]),e._v(" "),a("el-checkbox",{attrs:{label:"PC"}},[e._v("PC网页")])],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"goods"},[a("el-row",[a("el-col",{staticClass:"title"},[a("p",[e._v("选择适用商品")])])],1),e._v(" "),a("el-row",{staticClass:"pl20"},[a("el-col",[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.selectVisible=!0}}},[e._v("选择商品")]),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:e.addItemBomb}},[e._v("批量导入商品")])],1)],1)],1),e._v(" "),a("div",{staticClass:"all"},[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form-item",{attrs:{prop:"is_check_all",label:"是否全选当前店铺所有商品:","label-width":"200px"}},[a("el-radio-group",{model:{value:e.addCoupon.is_check_all,callback:function(t){e.$set(e.addCoupon,"is_check_all",t)},expression:"addCoupon.is_check_all"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),e._v(" "),a("div",{staticClass:"pl20 pt20"},[a("table-view",{ref:"goodsTable",attrs:{loading:e.loading,columns:e.columns,pageList:e.itemList}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"time"},[a("el-row",[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:"领取开始时间:",prop:"obtain_start_time"}},[a("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"领取开始时间"},model:{value:e.addCoupon.obtain_start_time,callback:function(t){e.$set(e.addCoupon,"obtain_start_time",t)},expression:"addCoupon.obtain_start_time"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:"领取结束时间:",prop:"obtain_end_time"}},[a("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"领取结束时间"},model:{value:e.addCoupon.obtain_end_time,callback:function(t){e.$set(e.addCoupon,"obtain_end_time",t)},expression:"addCoupon.obtain_end_time"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:"设置有效时间:",prop:"is_set_expiry_date"}},[a("el-radio-group",{model:{value:e.addCoupon.is_set_expiry_date,callback:function(t){e.$set(e.addCoupon,"is_set_expiry_date",t)},expression:"addCoupon.is_set_expiry_date"}},[a("el-radio",{attrs:{label:"1"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"0"}},[e._v("否")])],1)],1)],1)],1),e._v(" "),a("el-row",[1==e.addCoupon.is_set_expiry_date?a("el-col",{staticClass:"pr",attrs:{span:7}},[a("el-form-item",{attrs:{label:"使用有效期:",prop:"expiry_date"}},[a("el-input",{model:{value:e.addCoupon.expiry_date,callback:function(t){e.$set(e.addCoupon,"expiry_date",e._n(t))},expression:"addCoupon.expiry_date"}}),a("span",{staticClass:"pr30"},[e._v("天")])],1)],1):e._e()],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:15}},[0==e.addCoupon.is_set_expiry_date?a("el-form-item",{attrs:{label:"使用开始时间:",prop:"use_start_time"}},[a("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"领取开始时间"},model:{value:e.addCoupon.use_start_time,callback:function(t){e.$set(e.addCoupon,"use_start_time",t)},expression:"addCoupon.use_start_time"}})],1):e._e()],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:15}},[0==e.addCoupon.is_set_expiry_date?a("el-form-item",{attrs:{label:"使用结束时间:",prop:"use_end_time"}},[a("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"领取结束时间"},model:{value:e.addCoupon.use_end_time,callback:function(t){e.$set(e.addCoupon,"use_end_time",t)},expression:"addCoupon.use_end_time"}})],1):e._e()],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:e.addVisibleid},on:{"update:visible":function(t){e.addVisibleid=t}}},[a("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:e.goodsIds,callback:function(t){e.goodsIds=t},expression:"goodsIds"}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addVisibleid=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addGoodsById}},[e._v("确 定")])],1)],1),e._v(" "),a("select-goods",{attrs:{selectVisible:e.selectVisible,selectList:e.selectList},on:{"visible-change":e.handleVisible,"choose-submit":e.handleAdd}}),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.commitCoupon}},[e._v("提交")]),e._v(" "),a("el-button",{on:{click:e.backList}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(_,h,!1,function(e){a("7Xp+")},"data-v-7e2f17de",null);t.default=f.exports},m5p0:function(e,t,a){a("IHur"),e.exports=a("/KQr").Object.keys}});
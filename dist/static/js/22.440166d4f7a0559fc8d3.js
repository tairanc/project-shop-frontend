webpackJsonp([22],{Xeve:function(e,t){},lahK:function(e,t){},t3nw:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("3cXf"),a=i.n(s),n=i("qsHl"),l=(i("kIQj"),i("2AkA"),{name:"test1",data:function(){return{moveToId:-2,moveFileShow:!1,inputImgName:"",filterText:"",imgdir:[],selectImgList:[],selectFileList:[],checked:!1,imglist:[],img_total_count:0,storeItem:null,timeClickshow:!1,nameClickshow:!1,newFileName:"",newFileList:[],moveToFileList:[],moveToFileName:"",defaultProps:{children:"children",label:function(e){return e.name.length>10&&(e.name=e.name.slice(0,10)+"..."),e.name}},postparams:{file_id:"",keyword:"",page:1,page_size:20,order_bys:"created_at|desc"}}},components:{PaginationView:i("VXZc").a},methods:{handleExceed:function(e,t){this.$message.warning("已达到最大上传数量")},beforeAvatarUpload:function(e){var t=e.size/1024/1024<3;return t||this.$message.error("文件太大，请更换图片!"),t},upload:function(e){var t=this,i=new FileReader;i.readAsDataURL(e.file),i.onload=function(i){n.a.uploadImg({file_name:e.file.name,file_content:i.target.result,target_type:"20",image_type:"shop",file_id:t.storeItem.id}).then(function(e){0==e.code&&t.getImgFun(t.postparams)})}},handleNodeClick:function(e,t){var i=e.id;this.postparams={file_id:"",keyword:"",page:1,page_size:20,order_bys:"created_at|desc"},this.postparams.file_id=i,this.storeItem=e,this.getImgFun(this.postparams),this.newFileList=[],this.getNodeName(t,"local")},getNodeName:function(e,t){"moveFile"==t?0!=e.parent.level?(this.moveToFileList.unshift(e.data.name),this.getNodeName(e.parent,"moveFile")):(this.moveToFileList.unshift(e.data.name),this.joinNodeName("moveFile")):0!=e.parent.level?(this.newFileList.unshift(e.data.name),this.getNodeName(e.parent,"local")):(this.newFileList.unshift(e.data.name),this.joinNodeName("local"))},joinNodeName:function(e){"local"==e?this.newFileName=this.newFileList.join("    >    "):(this.moveToFileName=this.moveToFileList.join("  >  "),this.moveToFileName=this.moveToFileName)},moveHandleNodeClick:function(e,t){this.moveToId=e.id,this.moveToFileList=[],this.getNodeName(t,"moveFile")},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},addNewFile:function(){var e=this;this.$prompt("请输入文件夹名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"名称不能为空"}).then(function(t){var i={name:t.value,parent_id:e.storeItem.id,order:0};n.a.createImgFile(i).then(e.getImgFun(e.postparams),n.a.getImgDir({}).then(function(t){e.imgdir=t.data}))}).catch(function(){e.$message({type:"info",message:"取消输入"})})},reName:function(){var e=this,t={};this.imglist.map(function(e,i){e.select&&(t=e)}),this.$prompt("请输入新名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"名称不能为空"}).then(function(i){var s=i.value,a=t.id,l={name:s};"image"===t.content_type?l.image_id=a:(l.file_id=a,e.storeItem.children.map(function(e,t){e.id===a&&(e.name=s)})),n.a.renameImgFile(l).then(e.$set(t,"name",s))}).catch(function(){e.$message({type:"info",message:"取消输入"})})},moveFile:function(){this.moveFileShow=!0},cancelMove:function(){this.moveToId=-2,this.moveFileShow=!1},sureMove:function(){var e=this;if(-2==this.moveToId)this.$message({message:"请选择目录文件夹",type:"warning"});else{var t={file_ids:this.selectFileList,image_ids:this.selectImgList,target_file_id:this.moveToId,source_file_id:this.postparams.file_id};n.a.moveImgFile(t).then(function(t){e.getImgFun(e.postparams),n.a.getImgDir({}).then(function(t){var i=t.data;e.imgdir=i,e.selectImgList=[],e.selectFileList=[],e.moveFileShow=!1})})}},deleFile:function(){var e=this;if(this.selectImgList.length>0||this.selectFileList.length>0){var t={file_ids:this.selectFileList,image_ids:this.selectImgList};n.a.deleteImgFile(t).then(function(t){e.getImgFun(e.postparams),n.a.getImgDir({}).then(function(t){var i=t.data;e.imgdir=i,e.selectImgList=[],e.selectFileList=[]})})}},selectAllBtn:function(){var e=this;e.checked?e.imglist.map(function(t,i){0==t.select&&e.selectItem(t)}):e.imglist.map(function(t,i){t.select&&e.selectItem(t)})},sortImgList:function(e){var t="";"time"===e?(t=this.timeClickshow?"created_at|desc":"created_at|asc",this.timeClickshow=!this.timeClickshow,this.nameClickshow=!1):(t=this.nameClickshow?"name|desc":"name|asc",this.nameClickshow=!this.nameClickshow,this.timeClickshow=!1),this.postparams.order_bys=t,this.getImgFun(this.postparams)},selectItem:function(e){this.$set(e,"select",!e.select);var t=this.selectImgList.indexOf(e.id),i=this.selectFileList.indexOf(e.id);e.select?"image"===e.content_type?-1==t&&this.selectImgList.push(e.id):-1==i&&this.selectFileList.push(e.id):"image"===e.content_type?-1!=t&&this.selectImgList.splice(t,1):-1!=i&&this.selectFileList.splice(i,1),this.selectImgList.length+this.selectFileList.length==this.imglist.length?this.checked=!0:this.checked=!1},searchImg:function(){var e=JSON.parse(a()(this.postparams));e.keyword=this.inputImgName.trim(),this.getImgFun(e)},handleSizeChange:function(e){this.postparams.page_size=e,this.getImgFun(this.postparams)},handleNumberChange:function(e){this.postparams.page=e,this.getImgFun(this.postparams)},getImgFun:function(e){var t=this;this.checked=!1,this.selectFileList=[],this.selectImgList=[],n.a.getImgList(e).then(function(e){var i=[];0===e.code&&e.data.data.length>0&&e.data.data.map(function(e,t){e.select=!1,i.push(e)}),t.imglist=i,t.img_total_count=e.data.total_count})}},mounted:function(){var e=this;n.a.getImgDir({}).then(function(t){var i=t.data;if(e.imgdir=i,i&&i.length>0){e.newFileName=i[0].name;var s=i[0].id;e.postparams.file_id=s,e.storeItem=i[0],e.getImgFun(e.postparams)}})},watch:{filterText:function(e){this.$refs.tree2.filter(e)}}}),o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"imgspace"},[i("el-card",{staticClass:"box-card"},[i("el-container",[i("el-aside",[i("div",{staticClass:"imgspace_left_name"},[e._v("图片目录")]),e._v(" "),i("el-input",{attrs:{size:"small",placeholder:"按文件夹名称实时搜索"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),i("el-tree",{ref:"tree2",staticClass:"filter-tree",attrs:{data:e.imgdir,props:e.defaultProps,"default-expand-all":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),i("el-main",{staticClass:"imgspace_imgcontent"},[i("div",{staticClass:"imgspace_right_head"},[i("div",{staticClass:"imspace_right_position"},[e._v(e._s(e.newFileName))]),e._v(" "),i("el-upload",{attrs:{action:"11",accept:"image/*",multiple:"",limit:200,"on-exceed":e.handleExceed,"before-upload":e.beforeAvatarUpload,"http-request":e.upload,"show-file-list":!1}},[i("el-button",{attrs:{size:"small"}},[e._v("上传图片")])],1),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:e.addNewFile}},[e._v("新建文件夹")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.selectImgList.length+e.selectFileList.length==1,expression:"selectImgList.length + selectFileList.length == 1"}],attrs:{size:"small"},on:{click:e.reName}},[e._v("重命名")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.selectImgList.length+e.selectFileList.length>0,expression:"selectImgList.length + selectFileList.length > 0"}],attrs:{size:"small"},on:{click:e.moveFile}},[e._v("移动到")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.selectImgList.length+e.selectFileList.length>0,expression:"selectImgList.length + selectFileList.length > 0"}],attrs:{size:"small"},on:{click:e.deleFile}},[e._v("删除")]),e._v(" "),i("div",{staticClass:"imgspace_right_head_input"},[i("el-input",{attrs:{placeholder:"按文件夹名称/图片名称搜索",clearable:"",size:"small"},model:{value:e.inputImgName,callback:function(t){e.inputImgName=t},expression:"inputImgName"}}),e._v(" "),i("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"small"},on:{click:e.searchImg},slot:"append"})],1)],1),e._v(" "),i("div",{staticClass:"imgspace_content"},[i("div",{staticClass:"imgspace_content_select"},[i("el-checkbox",{on:{change:e.selectAllBtn},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("全选")]),e._v(" "),i("div",{staticClass:"imgspace_content_sort"},[i("span",[e._v("排序：")]),e._v(" "),i("span",{on:{click:function(t){return e.sortImgList("time")}}},[e._v("时间 "),i("i",{class:e.timeClickshow?"el-icon-arrow-up":"el-icon-arrow-down"})]),e._v(" "),i("span",{on:{click:function(t){return e.sortImgList("name")}}},[e._v("名称 "),i("i",{class:e.nameClickshow?"el-icon-arrow-up":"el-icon-arrow-down"})])])],1),e._v(" "),e.imglist.length>0?i("div",{staticClass:"imgspace_content_imgui"},e._l(e.imglist,function(t,s){return i("div",{key:s},["image"===t.content_type?i("div",{class:t.select?"imgspace_imgcontent_li_select":"imgspace_imgcontent_li",on:{click:function(i){return e.selectItem(t)}}},[i("img",{attrs:{src:t.url+"_m.jpg",alt:""}}),e._v(" "),t.name.length<10?i("span",[e._v(e._s(t.name))]):i("el-popover",{attrs:{placement:"top",width:"200",trigger:"hover",content:t.name}},[i("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.name.slice(0,10)+"..."))])])],1):i("div",{class:t.select?"imgspace_imgcontent_li_select":"imgspace_imgcontent_li",on:{click:function(i){return e.selectItem(t)}}},[i("div",[e._v("文件夹")]),e._v(" "),t.name.length<10?i("span",[e._v(e._s(t.name))]):i("el-popover",{attrs:{placement:"top",width:"200",trigger:"hover",content:t.name}},[i("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.name.slice(0,10)+"..."))])])],1)])}),0):e._e(),e._v(" "),i("pagination-view",{directives:[{name:"show",rawName:"v-show",value:e.imglist.length,expression:"imglist.length"}],attrs:{paginationName:"",total:e.img_total_count,currentPage:e.postparams.page},on:{"size-change":e.handleSizeChange,"current-change":e.handleNumberChange}})],1)])],1),e._v(" "),i("el-dialog",{staticClass:"dialog",attrs:{visible:e.moveFileShow,title:"移动到："+e.moveToFileName,"show-close":!1}},[i("el-tree",{staticClass:"filter-tree",attrs:{data:e.imgdir,props:e.defaultProps,"default-expand-all":!1},on:{"node-click":e.moveHandleNodeClick}}),e._v(" "),i("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.cancelMove}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.sureMove}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var c=i("C7Lr")(l,o,!1,function(e){i("lahK"),i("Xeve")},"data-v-474fae0e",null);t.default=c.exports}});
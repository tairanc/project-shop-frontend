webpackJsonp([4],{fvTl:function(e,t){},gK5d:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("3cXf"),l=a.n(o),i=a("4YfN"),n=a.n(i),s=a("4Xi4"),r=a.n(s),d=a("1G+u"),p=a("SZCj"),c={data:function(){var e=this;return{isNotAdd:!1,loading:!1,checkAll:!1,platform:[{label:"WX",name:"微信"},{label:"APP",name:"APP"},{label:"WAP",name:"移动端网页"},{label:"PC",name:"PC网页"}],goodsList:[],commitData:{},addCoupon:{coupon_name:"",item_id:"",send_quantity:"",user_obtain_limit:"",applicable_platform:[],item_ids:"",obtain_start_time:"",obtain_end_time:""},columns:[{label:"商品ID",field:"id",align:"center"},{label:"商品名称",align:"center",isGood:1},{label:"市场价",field:"market_price",align:"center"},{label:"标准售价",field:"sell_price",align:"center"}],addRules:{coupon_name:[{required:!0,message:"请输入1~20个字符",trigger:"blur"},{min:1,max:20,message:"请输入1~20个字符",trigger:"blur"}],send_quantity:[{required:!0,validator:function(e,t,a){t?r()(t)&&t>=1&&t<=999999999?a():a(new Error("请输入1~9个字符，仅限正整数")):a("请输入1~9个字符，仅限正整数")},trigger:"blur"}],user_obtain_limit:[{required:!0,validator:function(e,t,a){t?r()(t)&&t>=1&&t<=99999?a():a(new Error("请输入1~5个字符，仅限正整数")):a("请输入1~5个字符，仅限正整数")},trigger:"blur"}],applicable_platform:[{required:!0,message:"请选择适用平台",trigger:"change"}],obtain_start_time:[{required:!0,message:"请选择领取开始时间",trigger:"change"}],obtain_end_time:[{required:!0,message:"请选择领取结束时间",trigger:"change"}],item_id:[{validator:function(t,a,o){a?r()(a)&&a>=1&&a<=999999999?(e.goodsList=[],e.addGoodsById(a),o()):o(new Error("请输入1~9个字符，仅限正整数")):o(new Error("可免单的商品ID"))},trigger:"blur"}],alias:[{required:!0,message:"可免单的商品别名",trigger:"change"}],expiry_date:[{required:!0,message:"使用有效期",trigger:"change"}]}}},methods:{handleCheckAllChange:function(e){this.addCoupon.applicable_platform=e?["WX","APP","WAP","PC"]:[]},handleCheckedPlatformChange:function(e){var t=e.length;this.checkAll=t===this.platform.length},addGoodsById:function(e){var t=this;if(e){var a=this;p.a.importItemsById({item_id:e}).then(function(e){var o=e.data,l="";if(0==e.code){var i=[];i.push(o),a.goodsFilter(i)}else l+="<p>"+e.message+"</p>";l&&t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:l,type:"warning"})})}},goodsFilter:function(e){for(var t=0;t<e.length;t++){var a=!1;if(0!=this.goodsList.length)for(var o=0;o<this.goodsList.length;o++)a||e[t].id==this.goodsList[o].id&&(a=!0);a||this.goodsList.push(e[t])}},getEditcoupon:function(e){var t=this;p.a.getCoupon({coupon_id:e}).then(function(a){if(t.addCoupon=a.data,t.addCoupon.coupon_id=e,t.addCoupon.coupon_name=t.addCoupon.name,-1!=t.addCoupon.applicable_platform.indexOf("ALL"))t.addCoupon.applicable_platform=["WX","APP","WAP","PC"],t.checkAll=!0;else{t.addCoupon.applicable_platform=t.addCoupon.applicable_platform.split(",");var o=t.addCoupon.applicable_platform.indexOf("XCX");-1!=o&&t.addCoupon.applicable_platform.splice(o,1)}var l=[];l.push(a.data.item),t.goodsList=l})},commitCoupon:function(){var e=this,t=[];if(this.goodsList.forEach(function(e){t.push(e.id)}),this.addCoupon.item_ids=t.toString(),this.commitData=n()({},this.addCoupon),""==this.commitData.item_id&&(this.commitData.item_id=0),""==this.addCoupon.item_ids)this.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"请选择优惠券商品～",type:"warning"});else{var a=this;this.$refs.addCoupon.validate(function(t){if(!t)return!1;var o=JSON.parse(l()(a.commitData));4==o.applicable_platform.length&&(o.applicable_platform=["ALL"]),p.a.createCoupon(o,e.isNotAdd).then(function(t){0==t.code?(e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"优惠券添加成功",type:"success"}),e.$router.push({name:"exempt"})):e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:t.message,type:"warning"})})})}},backList:function(){this.$router.push({name:"exempt"})}},components:{TableView:d.a},created:function(){"editexempt"===this.$route.name&&(this.isNotAdd=!0,this.addCoupon.coupon_id=this.$route.query.id,this.getEditcoupon(this.addCoupon.coupon_id))}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"addCoupon",attrs:{model:e.addCoupon,rules:e.addRules,"label-width":"140px","label-position":"left"}},[a("div",{staticClass:"basic"},[a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"优惠券名称:",prop:"coupon_name"}},[a("el-input",{attrs:{placeholder:"优惠券名称"},model:{value:e.addCoupon.coupon_name,callback:function(t){e.$set(e.addCoupon,"coupon_name",t)},expression:"addCoupon.coupon_name"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"发放数量:",prop:"send_quantity"}},[a("el-input",{attrs:{placeholder:"发放数量"},model:{value:e.addCoupon.send_quantity,callback:function(t){e.$set(e.addCoupon,"send_quantity",e._n(t))},expression:"addCoupon.send_quantity"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"每人每张限领:",prop:"user_obtain_limit"}},[a("el-input",{attrs:{placeholder:"每人每张限领",maxlength:"5"},model:{value:e.addCoupon.user_obtain_limit,callback:function(t){e.$set(e.addCoupon,"user_obtain_limit",e._n(t))},expression:"addCoupon.user_obtain_limit"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:17,offset:1}},[a("el-form-item",{attrs:{label:"使用平台:",prop:"applicable_platform"}},[a("el-checkbox",{on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),a("el-checkbox-group",{staticClass:"addexempt_checkboxgroup",on:{change:e.handleCheckedPlatformChange},model:{value:e.addCoupon.applicable_platform,callback:function(t){e.$set(e.addCoupon,"applicable_platform",t)},expression:"addCoupon.applicable_platform"}},e._l(e.platform,function(t,o){return a("el-checkbox",{key:o,attrs:{label:t.label}},[e._v(e._s(t.name))])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"可免单的商品ID:",prop:"item_id"}},[a("el-input",{attrs:{placeholder:"可免单的商品ID"},model:{value:e.addCoupon.item_id,callback:function(t){e.$set(e.addCoupon,"item_id",e._n(t))},expression:"addCoupon.item_id"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"all"},[a("el-row",[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"pl20"},[a("table-view",{ref:"goodsTable",attrs:{loading:e.loading,columns:e.columns,pageList:e.goodsList}})],1)])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"可免单的商品别名:",prop:"alias"}},[a("el-input",{attrs:{placeholder:"可免单的商品别名",maxlength:"10"},model:{value:e.addCoupon.alias,callback:function(t){e.$set(e.addCoupon,"alias",e._n(t))},expression:"addCoupon.alias"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("p",{staticClass:"tips"},[e._v("为避免显示不全，请控制在十字以内")])])],1)],1),e._v(" "),a("div",{staticClass:"time"},[a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"发放开始时间：",prop:"obtain_start_time"}},[a("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"发放开始时间"},model:{value:e.addCoupon.obtain_start_time,callback:function(t){e.$set(e.addCoupon,"obtain_start_time",t)},expression:"addCoupon.obtain_start_time"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"发放结束时间：",prop:"obtain_end_time"}},[a("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"发放结束时间"},model:{value:e.addCoupon.obtain_end_time,callback:function(t){e.$set(e.addCoupon,"obtain_end_time",t)},expression:"addCoupon.obtain_end_time"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10,offset:1}},[a("el-form-item",{attrs:{label:"使用有效期",prop:"expiry_date"}},[a("el-input",{attrs:{placeholder:"使用有效期"},model:{value:e.addCoupon.expiry_date,callback:function(t){e.$set(e.addCoupon,"expiry_date",e._n(t))},expression:"addCoupon.expiry_date"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("p",{staticClass:"tips"},[e._v("天      将自动顺延为有效期当天23点59分59秒失效")])])],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.commitCoupon}},[e._v("提交")]),e._v(" "),a("el-button",{on:{click:e.backList}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var m=a("C7Lr")(c,u,!1,function(e){a("fvTl")},"data-v-5394e37c",null);t.default=m.exports}});
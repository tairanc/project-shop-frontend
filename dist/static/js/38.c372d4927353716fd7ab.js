webpackJsonp([38],{"+GZ5":function(t,e){},QEtQ:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("3cXf"),l=i.n(s),n=i("qsHl"),c={data:function(){return{allSelect:!1,list:[],oldList:[],deleteList:[]}},methods:{goToList:function(t){this.$router.push({path:"/goods-manage/goods/manage/sale?category_id="+t})},handleAll:function(){var t=this.allSelect;this.list.map(function(e){e.select=t,e.children.map(function(e){e.select=t})})},handleParent:function(t){var e=this.list[t].select;this.list[t].children.map(function(t){t.select=!e})},handleChild:function(t){this.list[t].children.some(function(t){return 0==t.select})&&(this.list[t].select=!1,this.allSelect=!1)},deleteAll:function(){var t=this;this.list.map(function(e){e.children=e.children.filter(function(e){return e.select&&e.id&&t.deleteList.push(e.id),0==e.select}),e.children.map(function(t,e){t.sort=e})}),this.list=this.list.filter(function(e){return e.select&&e.id&&t.deleteList.push(e.id),0==e.select}),this.list.map(function(t,e){t.sort=e}),this.allSelect=!1},addParentItem:function(){var t=this.list.length;this.list.push({name:"",sort:t,show:!1,children:[]})},deleteParent:function(t){var e=this.list.length;if(this.list[t].children.length)this.$message({message:"该分类下有子分类！",type:"error"});else if(this.list[t].id&&this.deleteList.push(this.list[t].id),this.list.splice(t,1),t!==e)for(var i=t;i<e-1;i++)this.list[i].sort=i},deleteChild:function(t,e){var i=this.list[t].children,s=i.length;if(i[e].id&&this.deleteList.push(i[e].id),i.splice(e,1),e!==s)for(var l=e;l<s-1;l++)i[l].sort=l},addChildItem:function(t){this.list[t].show=!0;var e=this.list[t].children.length;this.list[t].children.push({name:"",sort:e})},showChild:function(t){this.list[t].show=!this.list[t].show},parentMoveTop:function(t){if(0!=t)for(var e=t;e>0;e--)this.parentMoveUp(e)},parentMoveUp:function(t){if(0!=t){var e=this.list[t];this.list.splice(t,1,this.list[t-1]),this.list.splice(t-1,1,e),this.list[t].sort+=1,this.list[t-1].sort-=1}},parentMoveDown:function(t){if(t!=this.list.length-1){var e=this.list[t];this.list.splice(t,1,this.list[t+1]),this.list.splice(t+1,1,e),this.list[t].sort-=1,this.list[t+1].sort+=1}},parentMoveBottom:function(t){if(t!=this.list.length-1)for(var e=t;e<this.list.length-1;e++)this.parentMoveDown(e)},childMoveTop:function(t,e){if(0!=e)for(var i=e;i>0;i--)this.childMoveUp(t,i)},childMoveUp:function(t,e){if(0!=e){var i=this.list[t].children,s=i[e];i.splice(e,1,i[e-1]),i.splice(e-1,1,s),i[e].sort+=1,i[e-1].sort-=1}},childMoveDown:function(t,e){var i=this.list[t].children;if(e!=i.length-1){var s=i[e];i.splice(e,1,i[e+1]),i.splice(e+1,1,s),i[e].sort-=1,i[e+1].sort+=1}},childMoveBottom:function(t,e){var i=this.list[t].children;if(e!=i.length-1)for(var s=e;s<i.length-1;s++)this.childMoveDown(t,s)},saveCategory:function(){var t=this,e={cat_data:this.list,origin_cat_data:this.oldList,delete_cat_ids:this.deleteList};n.a.saveCategory(e).then(function(e){0==e.code&&(t.$message({type:"success",message:"保存成功"}),t.getCategory())})},getCategory:function(){var t=this;n.a.getCategory().then(function(e){if(0===e.code){for(var i in t.oldList=JSON.parse(l()(e.data)),t.list=[],t.deleteList=[],t.allSelect=!1,e.data){t.list.push(e.data[i]);var s=t.list.length-1;t.$set(t.list[s],"show",!1),t.$set(t.list[s],"select",!1);var n=[];if(t.list[s].children){for(var c in t.list[s].children)n.push(t.list[s].children[c]),t.$set(t.list[s].children[c],"select",!1);n.sort(function(t,e){return t.sort-e.sort})}t.$set(t.list[s],"children",n)}t.list.sort(function(t,e){return t.sort-e.sort})}})}},created:function(){this.getCategory()}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"category"},[i("div",[i("el-button",{on:{click:t.deleteAll}},[t._v("批量删除")]),t._v(" "),i("el-button",{on:{click:t.addParentItem}},[t._v("添加分类")]),t._v(" "),i("el-button",{on:{click:t.saveCategory}},[t._v("保存更改")])],1),t._v(" "),i("div",{staticClass:"table"},[i("ul",{staticClass:"title"},[i("li",{staticClass:"width-5"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.allSelect,expression:"allSelect"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.allSelect)?t._i(t.allSelect,null)>-1:t.allSelect},on:{change:[function(e){var i=t.allSelect,s=e.target,l=!!s.checked;if(Array.isArray(i)){var n=t._i(i,null);s.checked?n<0&&(t.allSelect=i.concat([null])):n>-1&&(t.allSelect=i.slice(0,n).concat(i.slice(n+1)))}else t.allSelect=l},t.handleAll]}})]),t._v(" "),i("li",{staticClass:"width-30"},[t._v("分类名称")]),t._v(" "),i("li",{staticClass:"width-15"},[t._v("排序")]),t._v(" "),i("li",{staticClass:"width-15"},[t._v("创建时间")]),t._v(" "),i("li",{staticClass:"width-15"},[t._v("修改时间")]),t._v(" "),i("li",{staticClass:"width-20"},[t._v("操作")])]),t._v(" "),i("div",{staticClass:"body"},t._l(t.list,function(e,s){return i("div",{key:s,staticClass:"parent"},[i("ul",{staticClass:"item"},[i("li",{staticClass:"width-5"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.select,expression:"items.select"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.select)?t._i(e.select,null)>-1:e.select},on:{click:function(e){return t.handleParent(s)},change:function(i){var s=e.select,l=i.target,n=!!l.checked;if(Array.isArray(s)){var c=t._i(s,null);l.checked?c<0&&t.$set(e,"select",s.concat([null])):c>-1&&t.$set(e,"select",s.slice(0,c).concat(s.slice(c+1)))}else t.$set(e,"select",n)}}})]),t._v(" "),i("li",{staticClass:"width-30"},[i("i",{class:e.show?"el-icon-caret-bottom":"el-icon-caret-right",on:{click:function(e){return t.showChild(s)}}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"items.name"}],attrs:{type:"text"},domProps:{value:e.name},on:{input:function(i){i.target.composing||t.$set(e,"name",i.target.value)}}})]),t._v(" "),i("li",{staticClass:"width-15"},[i("i",{staticClass:"el-icon-download rotate180",on:{click:function(e){return t.parentMoveTop(s)}}}),t._v(" "),i("i",{staticClass:"el-icon-arrow-up",on:{click:function(e){return t.parentMoveUp(s)}}}),t._v(" "),i("i",{staticClass:"el-icon-arrow-down",on:{click:function(e){return t.parentMoveDown(s)}}}),t._v(" "),i("i",{staticClass:"el-icon-download",on:{click:function(e){return t.parentMoveBottom(s)}}})]),t._v(" "),i("li",{staticClass:"width-15"},[t._v(t._s(e.created_at))]),t._v(" "),i("li",{staticClass:"width-15"},[t._v(t._s(e.updated_at))]),t._v(" "),i("li",{staticClass:"width-20"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.deleteParent(s)}}},[t._v("删除")]),t._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.goToList(e.id)}}},[t._v("查看")]),t._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.addChildItem(s)}}},[t._v("添加子分类")])],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"items.show"}],staticClass:"child"},t._l(e.children,function(e,l){return i("ul",{key:l,staticClass:"item"},[i("li",{staticClass:"width-5"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.select,expression:"item.select"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.select)?t._i(e.select,null)>-1:e.select},on:{change:[function(i){var s=e.select,l=i.target,n=!!l.checked;if(Array.isArray(s)){var c=t._i(s,null);l.checked?c<0&&t.$set(e,"select",s.concat([null])):c>-1&&t.$set(e,"select",s.slice(0,c).concat(s.slice(c+1)))}else t.$set(e,"select",n)},function(e){return t.handleChild(s)}]}})]),t._v(" "),i("li",{staticClass:"width-30"},[i("i",{staticClass:"el-icon-minus"}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"item.name"}],attrs:{type:"text"},domProps:{value:e.name},on:{input:function(i){i.target.composing||t.$set(e,"name",i.target.value)}}})]),t._v(" "),i("li",{staticClass:"width-15"},[i("i",{staticClass:"el-icon-download rotate180",on:{click:function(e){return t.childMoveTop(s,l)}}}),t._v(" "),i("i",{staticClass:"el-icon-arrow-up",on:{click:function(e){return t.childMoveUp(s,l)}}}),t._v(" "),i("i",{staticClass:"el-icon-arrow-down",on:{click:function(e){return t.childMoveDown(s,l)}}}),t._v(" "),i("i",{staticClass:"el-icon-download",on:{click:function(e){return t.childMoveBottom(s,l)}}})]),t._v(" "),i("li",{staticClass:"width-15"},[t._v(t._s(e.created_at))]),t._v(" "),i("li",{staticClass:"width-15"},[t._v(t._s(e.updated_at))]),t._v(" "),i("li",{staticClass:"width-20"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.deleteChild(s,l)}}},[t._v("删除")]),t._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.goToList(e.id)}}},[t._v("查看")])],1)])}),0)])}),0)])])},staticRenderFns:[]};var o=i("C7Lr")(c,a,!1,function(t){i("+GZ5")},"data-v-bf74426a",null);e.default=o.exports}});
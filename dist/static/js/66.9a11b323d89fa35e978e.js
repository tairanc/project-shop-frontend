webpackJsonp([66],{dvyK:function(e,t){},g3EO:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("3cXf"),o=s.n(i),a=s("wSwi"),l=s("UMpo"),n=s("kvg+"),r=s("6PaB"),d={data:function(){return{type:"FlashSale",flash_sale_id:"",apply_id:"",message:{},addVisibleid:!1,goodsIds:"",selectVisible:!1,goodsList:[]}},computed:{selectList:function(){var e=[];return this.goodsList&&this.goodsList.map(function(t){-1==e.indexOf(t.item_id)&&e.push(t.item_id)}),e},spanArr:function(){return Object(r.a)(this.goodsList)}},methods:{getFlashSaleDetail:function(e){var t=this;l.a.getFlashSaleDetail(e).then(function(e){if(0==e.code)switch(t.message=e.data,t.message.type){case"FlashSale":t.message.type="单品特卖";break;case"SpecialFlashSale":t.message.type="专场特卖"}})},getFlashSaleApplyList:function(e){var t=this;l.a.getFlashSaleApplyList(e).then(function(e){0==e.code&&(t.total=e.data.total_count,t.goodsList=e.data.list,t.goodsList&&t.goodsList.map(function(e){switch(e.verify_status){case"pending":e.verify_status="未审核";break;case"agree":e.verify_status="审核通过";break;case"refuse":e.verify_status="审核未通过"}t.$set(e,"edit",!1)}))})},addItemBomb:function(){this.addVisibleid=!0,this.goodsIds=""},addGoodsById:function(){var e=this;this.goodsIds&&n.a.importItemsById({item_id:this.goodsIds,promotion_id:this.flash_sale_id,promotion_type:"FlashSale",return_by:"sku"}).then(function(t){var s=t.data,i="";if(0!=s.itemList.length&&e.goodsFilter(s.itemList),0!=s.inValidItems.length)for(var o=0;o<s.inValidItems.length;o++)i+="<p>异常商品ID:"+s.inValidItems[o]+"</p>";if(0!=s.unsatisfiedItems.length)for(var a=0;a<s.unsatisfiedItems.length;a++)i+="<p>参加了不可叠加的商品:"+s.unsatisfiedItems[a]+"</p>";i&&e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:i,type:"warning"})}),this.goodsIds="",this.addVisibleid=!1},goodsFilter:function(e){for(var t=0;t<e.length;t++){var s=!1;if(0!=this.goodsList.length)for(var i=0;i<this.goodsList.length;i++)e[t].id==this.goodsList[i].id&&(s=!0);s||(this.goodsList.push(e[t]),this.$set(e[t],"edit",!1),this.$set(e[t],"promotion_price",""),this.$set(e[t],"promotion_store",""),this.$set(e[t],"verify_status","未审核"))}var o=[];e.map(function(e){o.push(e.item_id)});for(var a=0;a<this.goodsList.length;a++)-1==o.indexOf(this.goodsList[a].item_id)&&(this.goodsList.splice(a,1),a--)},handleVisible:function(e){this.selectVisible=e},handleAdd:function(e){var t=this;n.a.importItemsById({item_id:e,promotion_id:this.flash_sale_id,promotion_type:"FlashSale",return_by:"sku"}).then(function(e){var s=e.data,i="";if(0!=s.itemList.length&&t.goodsFilter(s.itemList),0!=s.inValidItems.length)for(var o=0;o<s.inValidItems.length;o++)i+="<p>异常商品ID:"+s.inValidItems[o]+"</p>";if(0!=s.unsatisfiedItems.length)for(var a=0;a<s.unsatisfiedItems.length;a++)i+="<p>参加了不可叠加的商品:"+s.unsatisfiedItems[a]+"</p>";i&&t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:i,type:"warning"})})},spanMethod:function(e){e.row,e.column;var t=e.rowIndex,s=e.columnIndex;if(0===s||1===s||8===s||9===s)return 1==this.spanArr[t]?{rowspan:0,colspan:0}:0==this.spanArr[t]?{rowspan:1,colspan:1}:{rowspan:this.spanArr[t],colspan:1}},handleEdit:function(e){this.goodsList.map(function(t){t.item_id==e.item_id&&(t.edit=!0)})},handleCheck:function(e){var t=this,s=/^(\d+)$|^(\d+\.\d+)$/,i=/^(\d+)$/,o=!0;this.goodsList.map(function(a){a.item_id==e.item_id&&(a.promotion_price=parseFloat(a.promotion_price),a.promotion_store=parseInt(a.promotion_store),!s.test(a.promotion_price)||a.promotion_price>=parseFloat(a.sell_price)||0==a.promotion_price?(t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"仅限输入正数，保留两位小数，金额需小于标准售价",type:"warning"}),o=!1):a.promotion_price=parseFloat(a.promotion_price).toFixed(2),(!i.test(a.promotion_store)||a.promotion_store>parseFloat(a.store)||0==a.promotion_store)&&(t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"仅限输入正整数，活动库存不得大于可售库存",type:"warning"}),o=!1))}),this.goodsList.map(function(t){t.item_id==e.item_id&&o&&(t.edit=!1)})},handleDelete:function(e){this.goodsList=this.goodsList.filter(function(t){return t.item_id!=e.item_id})},handleSubmit:function(){var e=this,t=[];this.goodsList.map(function(e){t.push({item_id:e.item_id,sku_id:e.id,price:e.promotion_price,store:e.promotion_store})}),l.a.applyFlashSale({flash_sale_id:this.flash_sale_id,apply_id:this.apply_id,items:o()(t)}).then(function(t){0==t.code&&(e.$message({showClose:!0,message:"报名成功",type:"success"}),e.$router.push({name:"applylist"}))})}},components:{SelectGoods:a.a},created:function(){this.flash_sale_id=this.$route.query.sale_id,-1!=this.$route.query.apply_id&&(this.apply_id=this.$route.query.apply_id,this.getFlashSaleApplyList({apply_id:this.apply_id,page:1,page_size:20,no_limit:"true"})),this.getFlashSaleDetail({flash_sale_id:this.flash_sale_id,apply_id:this.apply_id})}},p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"detail"},[s("div",{staticClass:"content"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.message.refuse_reason,expression:"message.refuse_reason"}],staticClass:"reason"},[e._v("审核驳回原因："+e._s(e.message.refuse_reason))]),e._v(" "),s("h3",[e._v("活动信息")]),e._v(" "),s("el-row",[s("el-col",[s("p",[e._v("活动名称： "+e._s(e.message.name))])]),e._v(" "),s("el-col",[s("p",[e._v("活动标签： "+e._s(e.message.type))])]),e._v(" "),s("el-col",[s("p",[e._v("每人每件限购： "+e._s(e.message.user_buy_limit)+"件")])]),e._v(" "),s("el-col",[s("p",[e._v("店铺商品限量： "+e._s(e.message.shop_apply_limit)+"件")])]),e._v(" "),s("el-col",[s("p",[e._v("商品折扣范围： "+e._s(e.message.discount_min)+"%~"+e._s(e.message.discount_max)+"%")])]),e._v(" "),s("el-col",[s("p",[e._v("店铺类型： "+e._s(e.message.used_shop_type))])]),e._v(" "),s("el-col",[s("p",[e._v("适用分类： "+e._s(e.message.used_category))])]),e._v(" "),s("el-col",[s("p",[e._v("活动创建时间： "+e._s(e.message.created_at))])]),e._v(" "),s("el-col",[s("p",[e._v("活动发布时间： "+e._s(e.message.release_time))])]),e._v(" "),s("el-col",[s("p",[e._v("活动开始时间： "+e._s(e.message.start_time))])]),e._v(" "),s("el-col",[s("p",[e._v("活动结束时间： "+e._s(e.message.end_time))])]),e._v(" "),s("el-col",[s("p",[e._v("报名开始时间： "+e._s(e.message.apply_start_time))])]),e._v(" "),s("el-col",[s("p",[e._v("报名结束时间： "+e._s(e.message.apply_end_time))])]),e._v(" "),e.message.special_flash_sale_title?s("div",[s("el-col",[s("p",{staticClass:"pic"},[e._v("专场广告图："),s("img",{attrs:{src:e.message.special_flash_sale_image,width:"500"}})])]),e._v(" "),s("el-col",[s("p",[e._v("专场主标题："+e._s(e.message.special_flash_sale_title))])]),e._v(" "),s("el-col",[s("p",[e._v("专场副标题："+e._s(e.message.special_flash_sale_subtitle))])])],1):e._e()],1),e._v(" "),s("p",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.selectVisible=!0}}},[e._v("选择商品")]),e._v(" "),s("el-button",{on:{click:e.addItemBomb}},[e._v("批量导入商品")])],1),e._v(" "),s("el-table",{staticClass:"table",attrs:{data:e.goodsList,border:"",align:"center","span-method":e.spanMethod}},[s("el-table-column",{attrs:{align:"center",label:"商品ID",prop:"item_id"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("a",{staticClass:"goods_url",attrs:{href:e.defaultUrl("item_id",t.row),target:"_blank"}},[e._v(e._s(t.row.title))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"属性",prop:"spec_text"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"市场价（元）",prop:"market_price"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"标准售价（元）",prop:"sell_price"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"活动价（元）"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{directives:[{name:"show",rawName:"v-show",value:!t.row.edit,expression:"!scope.row.edit"}]},[e._v(e._s(t.row.promotion_price))]),e._v(" "),s("el-input",{directives:[{name:"show",rawName:"v-show",value:t.row.edit,expression:"scope.row.edit"}],attrs:{size:"mini"},model:{value:t.row.promotion_price,callback:function(s){e.$set(t.row,"promotion_price",s)},expression:"scope.row.promotion_price"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"可售库存",prop:"store"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"活动库存",prop:"promotion_store"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{directives:[{name:"show",rawName:"v-show",value:!t.row.edit,expression:"!scope.row.edit"}]},[e._v(e._s(t.row.promotion_store))]),e._v(" "),s("el-input",{directives:[{name:"show",rawName:"v-show",value:t.row.edit,expression:"scope.row.edit"}],attrs:{size:"mini"},model:{value:t.row.promotion_store,callback:function(s){e.$set(t.row,"promotion_store",s)},expression:"scope.row.promotion_store"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"审核状态",prop:"verify_status"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.edit,expression:"!scope.row.edit"}],attrs:{type:"text"},on:{click:function(s){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.edit,expression:"scope.row.edit"}],attrs:{type:"text"},on:{click:function(s){return e.handleCheck(t.row)}}},[e._v("保存")]),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),s("el-col",{attrs:{offset:10}},[s("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("提交")])],1)],1),e._v(" "),s("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:e.addVisibleid},on:{"update:visible":function(t){e.addVisibleid=t}}},[s("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:e.goodsIds,callback:function(t){e.goodsIds=t},expression:"goodsIds"}}),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.addVisibleid=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.addGoodsById}},[e._v("确 定")])],1)],1),e._v(" "),s("select-goods",{attrs:{promotionType:e.type,promotionId:e.flash_sale_id.toString(),selectList:e.selectList,selectVisible:e.selectVisible},on:{"visible-change":e.handleVisible,"choose-submit":e.handleAdd}})],1)},staticRenderFns:[]};var _=s("C7Lr")(d,p,!1,function(e){s("dvyK")},"data-v-53e9eda6",null);t.default=_.exports}});
webpackJsonp([63],{"9j+g":function(e,t){},nV7p:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("VXZc"),o=s("1G+u"),i=s("wSwi"),n=s("KJHC"),l=s("6PaB"),r=s("NcNL"),c=s.n(r),d=s("wJ7o"),p=s.n(d),g={data:function(){return{promotionType:"OptionBuy",addVisibleid:!1,selectVisible:!1,goodsIds:"",total:0,pageInfo:{promotion_id:"",page:1,page_size:20,item_search:null},pageInfoAll:{promotion_id:"",page:1,page_size:-1},message:{},goodsListAll:[],goodsList:[],columns:[{label:"商品ID",field:"item_id",align:"center"},{label:"商品名称",field:"title",align:"center"},{label:"属性",field:"spec_text",align:"center"},{label:"市场价（元）",field:"market_price",align:"center"},{label:"标准售价（元）",field:"sell_price",align:"center"},{label:"可售库存",field:"store",align:"center"},{label:"销量",field:"sales",align:"center"}]}},computed:{spanArr:function(){return Object(l.a)(this.goodsList)}},methods:{getOptionBuyDetail:function(e){var t=this;n.a.getOptionBuyDetail(e).then(function(e){0==e.code&&(t.message=e.data,t.goodsList=e.data.itemList.list,t.total=e.data.itemList.total_count)})},handleDelete:function(e){var t=this;n.a.closeOptionBuyItem({promotion_id:this.pageInfo.promotion_id,item_id:e.item_id}).then(function(e){0==e.code&&(t.$message({showClose:!0,message:"关闭商品成功",type:"success"}),t.getOptionBuyDetail(t.pageInfo))})},sizeChange:function(e){this.pageInfo.page_size=e,this.getOptionBuyDetail(this.pageInfo)},searchItem:function(){this.pageInfo.page=1,this.getOptionBuyDetail(this.pageInfo)},resetSearch:function(){this.pageInfo.page=1,this.pageInfo.item_search="",this.getOptionBuyDetail(this.pageInfo)},pageChange:function(e){this.pageInfo.page=e,this.getOptionBuyDetail(this.pageInfo)},exportForm:function(){var e=this;null!=e.pageInfo.item_search&&e.pageInfo.item_search.length>0?e.downFileData(e.goodsList):n.a.getOptionBuyDetail(this.pageInfoAll).then(function(t){e.downFileData(t.data.itemList.list)})},downFileData:function(e){e.length<1||(this.goodsListAll=e,setTimeout(function(){var e=p.a.utils.table_to_book(document.querySelector("#export-form")),t=p.a.write(e,{bookType:"xlsx",bookSST:!0,type:"array"});try{c.a.saveAs(new Blob([t],{type:"application/octet-stream"}),"商品列表.xlsx")}catch(e){"undefined"!=typeof console&&console.log(e,t)}return t},1e3),this.$message({showClose:!0,message:"导出成功",type:"success"}))},spanMethod:function(e){e.row,e.column;var t=e.rowIndex,s=e.columnIndex;if(0==s||1==s||7==s)return 1==this.spanArr[t]?{rowspan:0,colspan:0}:0==this.spanArr[t]?{rowspan:1,colspan:1}:{rowspan:this.spanArr[t],colspan:1}},addTicketGoods:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",s=[],a=[];this.goodsList.map(function(e,t){0!=e.status&&-1==a.indexOf(e.item_id)&&a.push(e.item_id)});("splice"==t?this.goodsIds.split(","):this.goodsIds).map(function(e,t){-1==a.indexOf(e)&&s.push({item_id:e})});s.length<1||n.a.appendItems({promotion_id:this.pageInfo.promotion_id,items:s}).then(function(t){if(0!=t.data.fail){for(var s="",a=t.data.message,o=t.data.message.length,i=0;i<o;i++)s+="<p>"+a[i]+"</p>";e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:s,type:"warning"})}else e.$message({showClose:!0,message:"添加商品成功",type:"success"}),e.addVisibleid=!1,e.getOptionBuyDetail(e.pageInfo)},function(t){e.$message({showClose:!0,message:t.message,type:"warning"})})},addItemBomb:function(){this.addVisibleid=!0,this.goodsIds=""},handleVisible:function(e){this.selectVisible=e},handleAdd:function(e){this.goodsIds=e,this.addTicketGoods()},goBack:function(){this.$router.go(-1)}},components:{PaginationView:a.a,TableView:o.a,SelectGoods:i.a},created:function(){this.pageInfo.promotion_id=this.$route.query.id,this.pageInfoAll.promotion_id=this.$route.query.id,this.getOptionBuyDetail(this.pageInfo)}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"detail"},[s("h3",[e._v("活动信息")]),e._v(" "),s("el-row",[s("el-col",[s("p",[e._v("活动名称： "+e._s(e.message.name))])]),e._v(" "),s("el-col",[s("p",[e._v("活动规则： "+e._s(e.message.ruleStr))])]),e._v(" "),s("el-col",[s("p",[e._v("活动创建时间： "+e._s(e.message.created_at))])]),e._v(" "),s("el-col",[s("p",[e._v("活动开始时间： "+e._s(e.message.start_time))])]),e._v(" "),s("el-col",[s("p",[e._v("活动结束时间： "+e._s(e.message.end_time))])])],1),e._v(" "),s("div",{staticClass:"goods"},[s("h3",[e._v("商品信息")]),e._v(" "),s("el-button",{on:{click:e.exportForm}},[e._v("导出报表")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.selectVisible=!0}}},[e._v("选择商品")]),e._v(" "),s("el-button",{on:{click:e.addItemBomb}},[e._v("批量导入商品")]),e._v(" "),s("el-input",{staticClass:"item_search",attrs:{placeholder:"请输入商品 ID 进行搜索",clearable:""},model:{value:e.pageInfo.item_search,callback:function(t){e.$set(e.pageInfo,"item_search",t)},expression:"pageInfo.item_search\t"}}),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchItem}},[e._v("搜索")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.resetSearch}},[e._v("重置")]),e._v(" "),s("div",{staticClass:"table"},[s("el-table",{attrs:{data:e.goodsList,border:"","span-method":e.spanMethod}},[s("el-table-column",{attrs:{align:"center",label:"商品ID",prop:"item_id"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("a",{staticClass:"goods_url",attrs:{href:e.defaultUrl("item_id",t.row),target:"_blank"}},[e._v(e._s(t.row.title))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"属性",prop:"spec_text"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"市场价（元）",prop:"market_price"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"标准售价（元）",prop:"sell_price"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"可售库存",prop:"store"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"销量",prop:"sales"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",disabled:!(1==t.row.status)||10==e.message.status||40==e.message.status||50==e.message.status},on:{click:function(s){return e.handleDelete(t.row)}}},[e._v(e._s(1==t.row.status?"关闭":"已关闭"))])]}}])})],1)],1),e._v(" "),s("pagination-view",{attrs:{currentPage:e.pageInfo.page,total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),e._v(" "),s("el-tabs",{attrs:{id:"export-form"}},[s("table-view",{attrs:{columns:e.columns,pageList:e.goodsListAll}})],1)],1),e._v(" "),s("el-dialog",{attrs:{width:"500px",title:"请输入商品ID，多个商品ID需用逗号间隔输入",visible:e.addVisibleid},on:{"update:visible":function(t){e.addVisibleid=t}}},[s("el-form",[s("el-form-item",[s("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入商品ID"},model:{value:e.goodsIds,callback:function(t){e.goodsIds=t},expression:"goodsIds"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.addVisibleid=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addTicketGoods("splice")}}},[e._v("确 定")])],1)],1),e._v(" "),s("select-goods",{attrs:{selectVisible:e.selectVisible,promotionType:e.promotionType},on:{"visible-change":e.handleVisible,"choose-submit":e.handleAdd}}),e._v(" "),s("el-row",[s("el-col",{attrs:{offset:10}},[s("el-button",{attrs:{type:"primary"},on:{click:e.goBack}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var m=s("C7Lr")(g,u,!1,function(e){s("9j+g")},"data-v-5dc8031a",null);t.default=m.exports}});
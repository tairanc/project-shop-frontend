webpackJsonp([13],{"855v":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("VXZc"),a=(i("1G+u"),i("elHK")),l=i("iVs4"),n=i("3cXf"),o=i.n(n),r=i("kvg+"),c={data:function(){return{goodsVisible:!1,total:0,item_num:0,all_rate:"",goodList:[],image_domain:"",warehouses:[],categoryList:[],category:[],brandList:[],selectForm:{warehouse_id:"",brand_id:"",categories:{primary_id:"",secondary_id:"",tertiary_id:""},title:"",trade_type:"",min_price:"",max_price:"",promotion_type:"",promotion_id:"",sale_type:"",page:1,page_size:14},goods:[],selectItems:[]}},props:{selectVisible:{type:Boolean,default:!1},promotionType:{type:String,default:""},saleType:{type:String,default:""},promotionId:{type:String,default:""},subType:{type:String,default:"item"},selectList:{type:Array,default:function(){return[]}}},watch:{selectList:function(){var e=this;this.goods.map(function(t){-1!=e.selectList.indexOf(t.id)&&(t.selected=!0)}),this.selectItems=this.selectList,this.goodList=this.selectList},selectVisible:function(){this.selectVisible&&(this.selectForm.page=1,this.getSelectItemList(this.selectForm))}},methods:{pageChange:function(e){this.selectForm.page=e,this.getSelectItemList(this.selectForm)},resetForm:function(){this.$refs.selectForm.resetFields(),this.selectForm.max_price="",this.category=[]},getWarehuoses:function(){var e=this;r.a.getWarehouse({page:1,page_size:-1}).then(function(t){0==t.code&&(e.warehouses=t.data.data)})},getCategories:function(){var e=this;r.a.getCategory().then(function(t){if(0===t.code){for(var i=0;i<t.data.length;i++)if(t.data[i].sub){t.data[i].children=t.data[i].sub;for(var s=t.data[i].children.length,a=0;a<s;a++)t.data[i].children[a].sub&&(t.data[i].children[a].children=t.data[i].children[a].sub)}e.categoryList=t.data}else e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:t.message,type:"warning"})}).catch(function(t){e.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:t.message,type:"error"})})},getBrandList:function(){var e=this,t=this.category.length,i={};switch(this.selectForm.brand_id="",t){case 1:i={category_id:this.category[0],level:1};break;case 2:i={category_id:this.category[1],level:2};break;case 3:i={category_id:this.category[2],level:3}}r.a.getRelBrandListByCategoryId(i).then(function(t){0==t.code&&(e.brandList=t.data)})},getSelectItemList:function(e){var t=this;switch(this.selectForm.categories={primary_id:"",secondary_id:"",tertiary_id:""},this.category.length){case 0:break;case 1:this.selectForm.categories.primary_id=this.category[0];break;case 2:this.selectForm.categories.secondary_id=this.category[1];break;case 3:this.selectForm.categories.tertiary_id=this.category[2]}this.selectForm.categories=o()(this.selectForm.categories),r.a.getSelectItemList(e).then(function(e){0==e.code&&(t.goods=e.data.list,t.total=e.data.total_count,t.image_domain=e.data.image_domain,t.goods.map(function(e){-1!=t.selectItems.indexOf(e.id)&&(e.selected=!0)}))})},handleSelect:function(e){if(e.rate=0==e.rate?"0":e.rate,e.is_special)return!1;this.goodList.length<30?(e.selected=!e.selected,e.selected?(this.selectItems.push(e.id),this.goodList.push(e),this.item_num=this.goodList.length):(this.selectItems=this.selectItems.filter(function(t){return t!=e.id}),this.goodList=this.goodList.filter(function(t){return t?t.id!=e.id:null}),this.item_num=this.goodList.length)):(e.selected=!1,this.selectItems=this.selectItems.filter(function(t){return t!=e.id}),this.goodList=this.goodList.filter(function(t){return t?t.id!=e.id:null}),this.item_num=this.goodList.length)},selectAll:function(){var e=this;this.goods.map(function(t){t.is_special||(t.selected=!0),-1!=e.selectItems.indexOf(t.id)||t.is_special||(t.rate=0==t.rate?"0":t.rate,e.selectItems.push(t.id),e.goodList.push(t))}),this.item_num=this.goodList.length},cancelAll:function(){var e=this;this.goods.map(function(t){t.selected=!1,e.selectItems=e.selectItems.filter(function(e){return e!=t.id}),e.goodList=e.goodList.filter(function(e){return e?e.id!=t.id:null})}),this.item_num=this.goodList.length},batchClick:function(){var e=this.goodList;if(this.all_rate>0&&this.all_rate<100){var t=(1*this.all_rate).toFixed(2);for(var i in e)e[i].rate=t}else this.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"请请输入大于0小于100的比率",type:"warning"})},handleCancel:function(){var e=this;this.goodsVisible=!1,this.$emit("visible-change",this.goodsVisible),this.goods.map(function(t){-1!=e.selectList.indexOf(t.id)&&(t.selected=!0)}),this.selectItems=this.selectList,this.resetForm(),this.goodList=[]},addSpecial:function(e){l.a.addSpecial(e).then(function(e){})},handleSubmit:function(){if(this.selectItems.length){this.goodsVisible=!1,this.$emit("visible-change",this.goodsVisible),this.$emit("choose-submit",this.selectItems);var e=[];for(var t in this.goodList){var i={item_id:"",rates:{}};i.item_id=this.goodList[t].id,i.rates={1:this.goodList[t].rate},e.push(i)}this.addSpecial({rates:e})}else this.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:"请选择商品",type:"warning"})}},created:function(){var e=this;this.goodsVisible=this.selectVisible,this.selectForm.promotion_type=this.promotionType,this.selectForm.sale_type=this.saleType,this.selectForm.promotion_id=this.promotionId,this.selectForm.sub_type=this.subType,this.getWarehuoses(),this.getCategories(),r.a.getRelBrandListByCategoryId().then(function(t){0==t.code&&(e.brandList=t.data)})}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"dialog",attrs:{width:"90%",title:"选择商品",visible:e.selectVisible,"show-close":!1}},[i("el-form",{ref:"selectForm",staticClass:"mt30",attrs:{inline:!0,model:e.selectForm,size:"small"}},[i("el-form-item",{attrs:{prop:"warehouse_id"}},[i("el-select",{attrs:{placeholder:"仓库"},model:{value:e.selectForm.warehouse_id,callback:function(t){e.$set(e.selectForm,"warehouse_id",t)},expression:"selectForm.warehouse_id"}},e._l(e.warehouses,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),i("el-form-item",[i("el-cascader",{attrs:{placeholder:"分类",options:e.categoryList,"show-all-levels":!1,"change-on-select":""},on:{change:e.getBrandList},model:{value:e.category,callback:function(t){e.category=t},expression:"category"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"brand_id"}},[i("el-select",{attrs:{placeholder:"品牌"},model:{value:e.selectForm.brand_id,callback:function(t){e.$set(e.selectForm,"brand_id",t)},expression:"selectForm.brand_id"}},e._l(e.brandList,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"trade_type"}},[i("el-select",{attrs:{placeholder:"贸易类型"},model:{value:e.selectForm.trade_type,callback:function(t){e.$set(e.selectForm,"trade_type",t)},expression:"selectForm.trade_type"}},[i("el-option",{attrs:{label:"国内贸易",value:10}}),e._v(" "),i("el-option",{attrs:{label:"海淘",value:20}}),e._v(" "),i("el-option",{attrs:{label:"跨境保税",value:30}}),e._v(" "),i("el-option",{attrs:{label:"跨境直邮",value:40}})],1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"title"}},[i("el-input",{staticClass:"title",attrs:{placeholder:"商品关键字"},model:{value:e.selectForm.title,callback:function(t){e.$set(e.selectForm,"title",t)},expression:"selectForm.title"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"价格：",prop:"min_price"}},[i("el-input",{model:{value:e.selectForm.min_price,callback:function(t){e.$set(e.selectForm,"min_price",t)},expression:"selectForm.min_price"}}),e._v("\n        —\n        "),i("el-input",{model:{value:e.selectForm.max_price,callback:function(t){e.$set(e.selectForm,"max_price",t)},expression:"selectForm.max_price"}})],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.getSelectItemList(e.selectForm)}}},[e._v("搜索")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.selectAll}},[e._v("全选当前页")])],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"text"},on:{click:e.cancelAll}},[e._v("清空当前页")]),e._v(" "),i("el-button",{attrs:{type:"text"},on:{click:e.resetForm}},[e._v("清空筛选条件")])],1)],1),e._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"left"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.goods.length,expression:"goods.length"}],staticClass:"goods"},e._l(e.goods,function(t){return i("div",{key:t.id,staticClass:"item",class:t.selected?"active":"",on:{click:function(i){return e.handleSelect(t)}}},[t.is_special?i("div",{staticClass:"shadow"},[e._v("推广中")]):e._e(),e._v(" "),i("div",{staticClass:"thumb"},[i("img",{attrs:{src:t.primary_image+"_t.jpg"}})]),e._v(" "),i("div",{staticClass:"title"},[e._v(e._s(t.title))])])}),0),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.goods.length,expression:"!goods.length"}],staticClass:"goods"},[i("div",{staticClass:"no-goods"},[e._v("暂无数据")])]),e._v(" "),i("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.goods.length,expression:"goods.length"}],staticClass:"pagination",attrs:{"current-page":e.selectForm.page,"page-size":e.selectForm.page_size,layout:"total, prev, pager, next, jumper",total:e.total||0},on:{"current-change":e.pageChange}})],1),e._v(" "),i("div",{staticClass:"right"},[i("p",[i("span",[e._v("已选中商品")]),i("span",{staticClass:"span02"},[e._v(e._s(e.item_num)+"/30")])]),e._v(" "),i("ul",e._l(e.goodList,function(t){return i("li",{key:t.id},[i("span",[i("img",{attrs:{src:t.primary_image+"_t.jpg"}})]),e._v(" "),i("el-input",{staticStyle:{dispaly:"inline-block",width:"80px","vertical-align":"top"},attrs:{type:"text"},model:{value:t.rate,callback:function(i){e.$set(t,"rate",i)},expression:"goods.rate"}}),i("span",{staticStyle:{"vertical-align":"top"}},[e._v("%")]),e._v(" "),i("div",{staticClass:"title"},[e._v("\n                    ("+e._s(t.title)+")\n                    "+e._s(t.rate)+"\n                  ")])],1)}),0),e._v(" "),i("el-input",{staticStyle:{width:"100px",dispaly:"inline-block"},model:{value:e.all_rate,callback:function(t){e.all_rate=t},expression:"all_rate"}}),e._v("%\n          "),i("el-button",{staticStyle:{"margin-left":"65px"},attrs:{type:"primary"},on:{click:e.batchClick}},[e._v("批量设置")])],1)]),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var h=i("C7Lr")(c,d,!1,function(e){i("B0KL")},"data-v-70457ed5",null).exports,m={data:function(){return{selectVisible:!1,checked:!1,end_time:"",checkList:[],total:0,list:[],goodsList:[],type:"invite",id:{item_ids:[]},checkAll:!1,isIndeterminate:!0,form:{page:1,page_size:20},vipName:[]}},methods:{getItemList:function(e){var t=this;l.a.getItemList(e).then(function(e){for(var i in t.total=e.data.items.total_count,t.list=[],t.newRates=[],t.vipName=[],e.data.level_names)t.vipName.push(e.data.level_names[i]);for(var s in e.data.items.list){var a=e.data.items.list[s].remain_time;if(null==e.data.items.list[s].effecting_rates)e.data.items.list[s].rates=[{val:0,remain_time:a}];else{var l=[];for(var n in e.data.items.list[s].effecting_rates){var o=1*(1*n+1),r={val:0,remain_time:a};r.val=e.data.items.list[s].effecting_rates[n][o],l.push(r)}e.data.items.list[s].rates=l}t.list.push(e.data.items.list[s]),t.$set(e.data.items.list[s],"edit",!1)}})},checkedAll:function(){var e=this;e.checked=!e.checked,e.checked?(e.checkList=[],e.id.item_ids=[],e.list.forEach(function(t,i){e.checkList.push(t.item_id)}),e.id.item_ids=e.checkList):(e.checkList=[],e.id.item_ids=[])},oneChecked:function(e){var t=this.id.item_ids.indexOf(e);t>=0?this.id.item_ids.splice(t,1):this.id.item_ids.push(e)},delSelection:function(){this.removeSpecial(this.id),this.getItemList(this.form)},handleEdit:function(e){this.list.map(function(t){t.item_id==e.item_id&&(t.edit=!0)})},removeSpecial:function(e){var t=this;l.a.removeSpecial(e).then(function(e){t.$message({message:"删除成功",type:"success"})})},handleDelete:function(e){this.id.item_ids=[],this.id.item_ids.push(e.item_id),this.removeSpecial(this.id),this.getItemList(this.form)},handleCheck:function(e){var t=this,i={item_id:e.item_id,rates:[]},s=[];for(var a in e.rates){var n={};n[1*(1*a+1)]=e.rates[a].val,s.push(n)}i.rates=s,l.a.editSpecial(i).then(function(i){e.edit=!1,t.getItemList(t.form)})},handleSelectionChange:function(e){for(var t in this.id.item_ids=[],e)this.id.item_ids.push(e[t].item_id)},sizeChange:function(e){this.form.page_size=e,this.getItemList(this.form)},pageChange:function(e){this.form.page=e,this.getItemList(this.form)},handleVisible:function(e){this.selectVisible=e},handleAdd:function(e){var t=this;r.a.importItemsById({item_id:e}).then(function(e){var i=e.data;t.getItemList(t.form);var s="";if(0!=i.inValidItems.length)for(var a=0;a<i.inValidItems.length;a++)s+="<p>异常商品ID:"+i.inValidItems[a]+"</p>";if(0!=i.unsatisfiedItems.length)for(var l=0;l<i.unsatisfiedItems.length;l++)s+="<p>参加了不可叠加的商品:"+i.unsatisfiedItems[l]+"</p>";s&&t.$message({showClose:!0,dangerouslyUseHTMLString:!0,message:s,type:"warning"})})}},created:function(){this.getItemList(this.form)},mounted:function(){},computed:{selectList:function(){var e=[];return this.goodsList.map(function(t){-1==e.indexOf(t.item_id)&&e.push(t.item_id)}),e}},components:{PaginationView:s.a,invitesellGoods:h,CountDown:a.a}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"goodsBonus"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.selectVisible=!0}}},[e._v("添加主推商品")]),e._v(" "),i("el-button",{on:{click:e.delSelection}},[e._v("删除")]),e._v(" "),i("p"),e._v(" "),i("table",{staticStyle:{"border-collapse":"collapse"},attrs:{width:"100%"}},[i("tr",{staticClass:"goodsBonus_title"},[i("td",{attrs:{width:"35"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.checked,expression:"checked"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.checked)?e._i(e.checked,null)>-1:e.checked},on:{click:e.checkedAll,change:function(t){var i=e.checked,s=t.target,a=!!s.checked;if(Array.isArray(i)){var l=e._i(i,null);s.checked?l<0&&(e.checked=i.concat([null])):l>-1&&(e.checked=i.slice(0,l).concat(i.slice(l+1)))}else e.checked=a}}})]),e._v(" "),i("td",{attrs:{width:"50%"}},[e._v("主推商品")]),e._v(" "),e._l(e.vipName,function(t,s){return i("td",{key:s},[e._v("\n                "+e._s(t.name)+"提成比率\n            ")])}),e._v(" "),i("td",[e._v("\n                操作\n            ")])],2),e._v(" "),e._l(e.list,function(t,s){return i("tr",{key:s},[i("td",{staticClass:"tc",attrs:{width:"35"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.checkList,expression:"checkList"}],attrs:{type:"checkbox"},domProps:{value:t.item_id,checked:Array.isArray(e.checkList)?e._i(e.checkList,t.item_id)>-1:e.checkList},on:{click:function(i){return e.oneChecked(t.item_id)},change:function(i){var s=e.checkList,a=i.target,l=!!a.checked;if(Array.isArray(s)){var n=t.item_id,o=e._i(s,n);a.checked?o<0&&(e.checkList=s.concat([n])):o>-1&&(e.checkList=s.slice(0,o).concat(s.slice(o+1)))}else e.checkList=l}}})]),e._v(" "),i("td",[i("img",{staticClass:"img",attrs:{src:t.item_image+"_t.jpg"}}),e._v(" "),i("p",{staticStyle:{"vertical-align":"top",display:"inline-block",width:"70%"}},[i("a",{staticClass:"goods_url",attrs:{href:e.defaultUrl("item_id",t),target:"_blank"}},[e._v(e._s(t.item_title))])])]),e._v(" "),e._l(t.rates,function(s,a){return i("td",{directives:[{name:"show",rawName:"v-show",value:!t.edit,expression:"!goods.edit"}],key:a,staticClass:"tc"},[i("span",[e._v(e._s(s.val)+"%\n                    "),s.remain_time?i("el-popover",{attrs:{placement:"right",width:"210",trigger:"hover"}},[i("span",[e._v("距该修改生效还需时间:\n                            "),i("count-down",{attrs:{endTime:s.remain_time}})],1),e._v(" "),i("i",{staticClass:"el-icon-time",staticStyle:{color:"#409EFF"},attrs:{slot:"reference",icon:"el-icon-time"},slot:"reference"})]):e._e()],1)])}),e._v(" "),e._l(t.rates,function(s,a){return i("td",{directives:[{name:"show",rawName:"v-show",value:t.edit,expression:"goods.edit"}],key:"key"+a,staticClass:"tc"},[i("el-input",{staticStyle:{width:"100px"},model:{value:s.val,callback:function(t){e.$set(s,"val",t)},expression:"rate.val"}}),e._v("%\n            ")],1)}),e._v(" "),i("td",{staticClass:"tc",staticStyle:{color:"#409EFF"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.edit,expression:"!goods.edit"}]},[i("a",{on:{click:function(i){return e.handleEdit(t)}}},[e._v("编辑")]),e._v(" "),i("a",{on:{click:function(i){return e.handleDelete(t)}}},[e._v("删除")])]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.edit,expression:"goods.edit"}],attrs:{type:"primary"},on:{click:function(i){return e.handleCheck(t)}}},[e._v("保存修改")])],1)],2)})],2),e._v(" "),i("pagination-view",{directives:[{name:"show",rawName:"v-show",value:e.list.length,expression:"list.length"}],attrs:{currentPage:e.form.page,total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),e._v(" "),i("invitesell-goods",{attrs:{saleType:e.type,selectVisible:e.selectVisible,selectList:e.selectList},on:{"visible-change":e.handleVisible,"choose-submit":e.handleAdd}})],1)},staticRenderFns:[]};var g=i("C7Lr")(m,u,!1,function(e){i("Lldh")},"data-v-5da6f5da",null);t.default=g.exports},B0KL:function(e,t){},Lldh:function(e,t){},elHK:function(e,t,i){"use strict";var s={data:function(){return{time:"",flag:!1,h:"",m:"",s:"",endTime:this.endTime}},props:{endTime:{type:String,default:""}},mounted:function(){var e=this,t=setInterval(function(){1==e.flag&&(clearInterval(t),window.location.reload()),e.timeDown()},1e3)},methods:{timeDown:function(){var e=this.endTime.split(":"),t=this.formate(e[0]),i=this.formate(e[1]),s=this.formate(e[2]);this.h=1*t,this.m=1*i,this.s=1*s,0==this.h&&0==this.m&&0==this.s?this.flag=!0:(this.s<=0?(this.s=59,this.m--):this.m<=0&&0!=this.h?(this.m=59,this.h--):this.s--,this.endTime=this.formate(this.h)+":"+this.formate(this.m)+":"+this.formate(this.s),this.time=this.endTime)},formate:function(e){return e>=10?e:"0"+e}}},a={render:function(){var e=this.$createElement;return(this._self._c||e)("span",[this._v("\n    "+this._s(this.time)+"\n")])},staticRenderFns:[]},l=i("C7Lr")(s,a,!1,null,null,null);t.a=l.exports}});
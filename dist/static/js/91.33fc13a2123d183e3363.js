webpackJsonp([91],{C2ae:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=e("4YfN"),i=e.n(o),l=e("3cXf"),a=e.n(l),n=e("QtZ6"),c=e("wSwi"),r=e("2bvH"),d=e("iled"),u=e("kvg+"),m=/(http|ftp|https):\/\/[\w\-_]+(\.[trc\-_]+)+([\w\-\.,@?^=%&:/~\+#]*[\w\-\@?^=%&/~\+#])?/,p={data:function(){return{defaultImg:'this.src="'+e("/BKo")+'"',selectVisible:!1,sign:{},modules:[],has_coupon:!1,floorVisible:!1,floor_message:{},slideVisible:!1,imgSeclect:!1,currentModule:{},picIndex:0}},methods:{selectGoods:function(t){var s=this;u.a.importItemsById({item_id:t}).then(function(t){if(0==t.code){for(var e=s.floor_message.data.length,o=function(e){t.data.itemList=t.data.itemList.filter(function(t){return t.id!=s.floor_message.data[e].id})},i=0;i<e;i++)o(i);t.data.itemList.map(function(t,o){t.sort=e+o,s.floor_message.data.push(t)})}})},handleVisible:function(t){this.selectVisible=t},wapIndex:function(t){var s=this;d.a.wapIndex(t).then(function(t){0==t.code&&(s.sign=t.data.sign,s.modules=t.data.shop_decoration_data.modules,s.modules.map(function(t){"coupon"==t.type&&(s.has_coupon=!0)}))})},showFloorDialog:function(t,s){this.floorVisible=!0,this.currentModule=s,this.floor_message=JSON.parse(a()(t))},deleteFloor:function(t){"coupon"==this.modules[t].type&&(this.has_coupon=!1);for(var s=t+1;s<this.modules.length;s++)this.modules[s].sort-=1;this.modules.splice(t,1)},addCoupon:function(){var t=this;this.has_coupon?this.$message({showClose:!0,message:"优惠券只能添加一份",type:"warning"}):d.a.shopCoupons().then(function(s){s.data.length?(t.modules.push({name:"优惠券",type:"coupon",data:s.data,sort:t.modules.length}),t.has_coupon=!0,t.$message({showClose:!0,message:"添加优惠券楼层成功",type:"success"})):t.$message({showClose:!0,message:"请先配置优惠券",type:"error"})})},addFloor:function(){this.modules.push({name:"新楼层",type:"floor",sort:this.modules.length,data:[]}),this.$message({showClose:!0,message:"添加楼层成功",type:"success"})},addSlide:function(){this.modules.push({name:"轮播图",type:"slide",sort:this.modules.length,data:[]}),this.$message({showClose:!0,message:"添加楼层成功",type:"success"})},modulesTop:function(t){if(0!=t){var s=this.modules[t-1];this.modules.splice(t-1,1,this.modules[t]),this.modules.splice(t,1,s),this.modules[t-1].sort--,this.modules[t].sort++}},modulesBottom:function(t){if(t!=this.modules.length-1){var s=this.modules[t+1];this.modules.splice(t+1,1,this.modules[t]),this.modules.splice(t,1,s),this.modules[t+1].sort++,this.modules[t].sort--}},deleteGood:function(t){this.floor_message.data=this.floor_message.data.filter(function(s){return s.id!==t}),this.floor_message.data.map(function(t,s){t.sort=s})},goodsTop:function(t){if(0!=t){var s=this.floor_message.data,e=s[t-1];s.splice(t-1,1,s[t]),s.splice(t,1,e),s[t-1].sort--,s[t].sort++}},goodsBottom:function(t){var s=this.floor_message.data;if(t!=s.length-1){var e=s[t+1];s.splice(t+1,1,s[t]),s.splice(t,1,e),s[t+1].sort++,s[t].sort--}},saveGood:function(){this.floor_message.name.length>10||0==this.floor_message.name.length?this.$message({showClose:!0,message:"请填写符合要求的楼层名",type:"error"}):(this.$set(this.modules,this.currentModule,JSON.parse(a()(this.floor_message))),this.floorVisible=!1)},showSlideDialog:function(t,s){this.slideVisible=!0,this.currentModule=s,this.floor_message=JSON.parse(a()(t)),this.floor_message.data.map(function(t,s){t.id=s})},addSlideList:function(){this.floor_message.data.push({image:"",link:"",sort:this.floor_message.data.length-1,id:this.floor_message.data.length-1})},showPicSelect:function(t){this.picIndex=t,this.imgSeclect=!0},savePic:function(){this.floor_message.data.length||(this.floor_message.data=[{}]),this.$set(this.floor_message.data[this.picIndex],"image",this.sellImgSrc),this.imgSeclect=!1},saveSlide:function(){if(0==this.floor_message.data.length||this.floor_message.data.length>10)this.$message({showClose:!0,message:"至少配置一张图片及链接且不超过10张",type:"error"});else{var t=!1;this.floor_message.data.map(function(s){s.image&&s.link&&m.test(s.link)||(t=!0)}),t?this.$message({showClose:!0,message:"请填写正确的图片链接或者泰然城链接",type:"error"}):(this.$set(this.modules,this.currentModule,JSON.parse(a()(this.floor_message))),this.slideVisible=!1)}},savePcDecorate:function(){var t=this,s={platform:"app",modules_data:[]};this.modules.map(function(t){if("coupon"==t.type)s.modules_data.push({name:"优惠券",sort:t.sort,data:{type:"coupon",is_show_coupon:"1"}});else if("floor"==t.type){var e=[];t.data.map(function(t){e.push({item_id:t.id,sort:t.sort})}),s.modules_data.push({name:t.name,sort:t.sort,data:{type:"floor",item_list:e}})}else{var o=[];t.data.map(function(t){o.push({link:t.link,image:t.image,sort:t.sort})}),s.modules_data.push({name:"轮播图",sort:t.sort,data:{type:"slide",list:o}})}}),d.a.saveWapDecorate(s).then(function(s){0==s.code&&(s.data.result&&t.$message({showClose:!0,message:"发布成功",type:"success"}),t.wapIndex({platform:"app"}))})}},computed:i()({},Object(r.c)(["sellImgSrc"])),components:{SellImgSelect:n.a,SelectGoods:c.a},created:function(){this.wapIndex({platform:"app"})}},f={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"main"},[e("el-card",[e("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("WAP店铺装修")]),t._v(" "),e("div",{staticClass:"btnGroup"},[e("el-button",{attrs:{type:"primary"},on:{click:t.savePcDecorate}},[t._v("发布")])],1)]),t._v(" "),e("div",{staticClass:"body"},[e("div",{staticClass:"left"},[e("i",{staticClass:"el-icon-picture",on:{click:t.addSlide}}),t._v(" "),e("p",[t._v("轮播图")]),t._v(" "),e("i",{staticClass:"el-icon-tickets",on:{click:t.addCoupon}}),t._v(" "),e("p",[t._v("优惠券")]),t._v(" "),e("i",{staticClass:"el-icon-menu",on:{click:t.addFloor}}),t._v(" "),e("p",[t._v("楼层")])]),t._v(" "),e("div",{staticClass:"right"},[e("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"搜索本店内商品"}}),t._v(" "),e("div",{staticClass:"title"},[e("img",{attrs:{width:"50",height:"50",src:t.sign.shop_logo+"_t.jpg",onerror:t.defaultImg}}),e("span",{staticClass:"name"},[t._v(t._s(t.sign.shop_name))])]),t._v(" "),e("div",{staticClass:"nav"},[e("ul",{staticClass:"nav-list"},[e("li",[t._v("店铺首页")]),t._v(" "),e("li",[t._v("全部商品")])])]),t._v(" "),e("div",{staticClass:"content"},t._l(t.modules,function(s,o){return"floor"==s.type?e("div",{key:o,staticClass:"goods"},[e("p",{staticClass:"goods-title"},[t._v("\n              "+t._s(s.name)+"\n              "),e("el-button",{staticClass:"fr",on:{click:function(e){return t.deleteFloor(s.sort)}}},[t._v("删除")]),t._v(" "),e("el-button",{staticClass:"fr",on:{click:function(e){return t.showFloorDialog(s,o)}}},[t._v("编辑")]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesBottom(o)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesTop(o)}}},[e("i",{staticClass:"el-icon-back up"})])],1),t._v(" "),e("div",{staticClass:"main"},[e("ul",{staticClass:"goods-list"},t._l(s.data,function(s){return e("li",[e("img",{attrs:{src:s.primary_image+"_s.jpg"}}),t._v(" "),e("p",{staticClass:"name"},[t._v(t._s(s.title))]),t._v(" "),e("span",[t._v("¥"+t._s(s.sell_price))])])}),0)])]):"coupon"==s.type?e("div",{staticClass:"coupons"},[e("p",{staticClass:"coupons-title"},[t._v("\n              优惠券\n              "),e("el-button",{staticClass:"fr",on:{click:function(e){return t.deleteFloor(s.sort)}}},[t._v("删除")]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesBottom(o)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesTop(o)}}},[e("i",{staticClass:"el-icon-back up"})])],1),t._v(" "),e("div",{staticClass:"main"},[e("ul",{staticClass:"coupons-list"},t._l(s.data,function(s,o){return o<2?e("li",[e("p",[t._v(t._s(s.name))]),t._v(" "),e("p",[t._v("¥ "+t._s(s.deduct_money))]),t._v(" "),e("p",[t._v("满"+t._s(s.limit_money)+"可用")])]):t._e()}),0)])]):e("div",{staticClass:"slide"},[e("p",{staticClass:"slide-title"},[t._v("\n              轮播图\n              "),e("el-button",{staticClass:"fr",on:{click:function(e){return t.deleteFloor(s.sort)}}},[t._v("删除")]),t._v(" "),e("el-button",{staticClass:"fr",on:{click:function(e){return t.showSlideDialog(s,o)}}},[t._v("编辑")]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesBottom(o)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesTop(o)}}},[e("i",{staticClass:"el-icon-back up"})])],1),t._v(" "),e("div",{staticClass:"main"},[s.data.length?e("img",{attrs:{src:s.data[0].image}}):t._e()])])}),0)],1)])]),t._v(" "),e("el-dialog",{attrs:{title:"楼层",visible:t.floorVisible,"close-on-click-modal":!1},on:{"update:visible":function(s){t.floorVisible=s}}},[e("div",[e("span",[t._v("楼层标题：")]),t._v(" "),e("el-input",{attrs:{size:"small"},model:{value:t.floor_message.name,callback:function(s){t.$set(t.floor_message,"name",s)},expression:"floor_message.name"}}),t._v("\n      10个字符以内，推荐使用四个汉字\n    ")],1),t._v(" "),e("div",{staticClass:"floor-dialog-body"},[e("el-table",{attrs:{data:t.floor_message.data,border:""}},[e("el-table-column",{attrs:{label:"上传商品"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("img",{staticClass:"table-img",attrs:{width:"50",height:"50",src:s.row.primary_image+"_t.jpg"}}),t._v(" "),e("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(s.row.title))])]}}])}),t._v(" "),e("el-table-column",{attrs:{align:"center",width:"200",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.goodsTop(s.$index)}}},[e("i",{staticClass:"el-icon-back up"})]),t._v(" "),e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.goodsBottom(s.$index)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"delete",attrs:{type:"primary",size:"small"},on:{click:function(e){return t.deleteGood(s.row.id)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),e("div",{staticClass:"floor-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.selectVisible=!0}}},[e("i",{staticClass:"el-icon-plus"},[t._v("添加商品")])]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.saveGood}},[t._v(" 保存")])],1)]),t._v(" "),e("el-dialog",{attrs:{title:"轮播图",width:"70%",visible:t.slideVisible,"close-on-click-modal":!1},on:{"update:visible":function(s){t.slideVisible=s}}},[e("div",{staticClass:"floor-dialog-body slide-dialog-body"},[e("el-table",{attrs:{data:t.floor_message.data,border:""}},[e("el-table-column",{attrs:{label:"图片地址"},scopedSlots:t._u([{key:"default",fn:function(s){return[t._v("\n            图片地址："),e("el-input",{model:{value:s.row.image,callback:function(e){t.$set(s.row,"image",e)},expression:"scope.row.image"}}),t._v(" "),e("el-button",{attrs:{size:"samll"},on:{click:function(e){return t.showPicSelect(s.$index)}}},[t._v("选择图片")])]}}])}),t._v(" "),e("el-table-column",{attrs:{label:"链接地址"},scopedSlots:t._u([{key:"default",fn:function(s){return[t._v("\n            链接地址："),e("el-input",{model:{value:s.row.link,callback:function(e){t.$set(s.row,"link",e)},expression:"scope.row.link"}})]}}])}),t._v(" "),e("el-table-column",{attrs:{align:"center",width:"180",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.goodsTop(s.$index)}}},[e("i",{staticClass:"el-icon-back up"})]),t._v(" "),e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.goodsBottom(s.$index)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"delete",attrs:{type:"primary",size:"small"},on:{click:function(e){return t.deleteGood(s.row.id)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),e("div",{staticClass:"floor-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.addSlideList}},[e("i",{staticClass:"el-icon-plus"},[t._v("添加")])]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.saveSlide}},[t._v(" 保存")])],1)]),t._v(" "),e("el-dialog",{attrs:{width:"70%",visible:t.imgSeclect,"show-close":!1,"close-on-click-modal":!1}},[e("sell-img-select",{ref:"refimguse"}),t._v(" "),e("div",{staticClass:"floor-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.imgSeclect=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.savePic}},[t._v("确定")])],1)],1),t._v(" "),e("select-goods",{attrs:{selectVisible:t.selectVisible,onlyShelving:"1",selectList:[]},on:{"visible-change":t.handleVisible,"choose-submit":t.selectGoods}})],1)},staticRenderFns:[]};var _=e("C7Lr")(p,f,!1,function(t){e("G9Nr")},"data-v-176f8fc0",null);s.default=_.exports},G9Nr:function(t,s){}});
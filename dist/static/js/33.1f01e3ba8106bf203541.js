webpackJsonp([33],{GafU:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("3cXf"),i=e.n(a),o=e("wSwi"),n=e("iled"),l=e("kvg+"),c={data:function(){return{defaultImg:'this.src="'+e("/BKo")+'"',selectVisible:!1,sign:{},nav:[],modules:[],has_coupon:!1,shop_cat_list:[],navVisible:!1,cateVisible:!1,floorVisible:!1,floor_message:{},currentModule:{},nav_message:[],defaultProps:{children:"children",label:"label"},checkedKey:[]}},methods:{selectGoods:function(t){var s=this;l.a.importItemsById({item_id:t}).then(function(t){if(0==t.code){for(var e=s.floor_message.data.length,a=function(e){t.data.itemList=t.data.itemList.filter(function(t){return t.id!=s.floor_message.data[e].id})},i=0;i<e;i++)a(i);t.data.itemList.map(function(t,a){t.sort=e+a,s.floor_message.data.push(t)})}})},handleVisible:function(t){this.selectVisible=t},pcIndex:function(t){var s=this;n.a.pcIndex(t).then(function(t){0==t.code&&(s.sign=t.data.sign,s.shop_cat_list=t.data.shop_cat_list,s.nav=t.data.shop_decoration_data.nav,s.modules=t.data.shop_decoration_data.modules,s.modules.map(function(t){"coupon"==t.type&&(s.has_coupon=!0)}),s.nav&&s.nav.map(function(t){s.$set(t,"show",!0)}))})},showNavDialog:function(){this.navVisible=!0,this.nav_message=JSON.parse(i()(this.nav))},showFloorDialog:function(t,s){this.floorVisible=!0,this.currentModule=s,this.floor_message=JSON.parse(i()(t))},deleteFloor:function(t){"coupon"==this.modules[t].type&&(this.has_coupon=!1);for(var s=t+1;s<this.modules.length;s++)this.modules[s].sort-=1;this.modules.splice(t,1)},addCoupon:function(){var t=this;this.has_coupon?this.$message({showClose:!0,message:"优惠券只能添加一份",type:"warning"}):n.a.shopCoupons().then(function(s){s.data.length?(t.modules.push({name:"优惠券",type:"coupon",data:s.data,sort:t.modules.length}),t.has_coupon=!0,t.$message({showClose:!0,message:"添加优惠券楼层成功",type:"success"})):t.$message({showClose:!0,message:"请先配置优惠券",type:"error"})})},addFloor:function(){this.modules.push({name:"新楼层",type:"floor",sort:this.modules.length,data:[]}),this.$message({showClose:!0,message:"添加楼层成功",type:"success"})},modulesTop:function(t){if(0!=t){var s=this.modules[t-1];this.modules.splice(t-1,1,this.modules[t]),this.modules.splice(t,1,s),this.modules[t-1].sort--,this.modules[t].sort++}},modulesBottom:function(t){if(t!=this.modules.length-1){var s=this.modules[t+1];this.modules.splice(t+1,1,this.modules[t]),this.modules.splice(t,1,s),this.modules[t+1].sort++,this.modules[t].sort--}},deleteGood:function(t){this.floor_message.data=this.floor_message.data.filter(function(s){return s.id!==t}),this.floor_message.data.map(function(t,s){t.sort=s})},goodsTop:function(t){if(0!=t){var s=this.floor_message.data,e=s[t-1];s.splice(t-1,1,s[t]),s.splice(t,1,e),s[t-1].sort--,s[t].sort++}},goodsBottom:function(t){var s=this.floor_message.data;if(t!=s.length-1){var e=s[t+1];s.splice(t+1,1,s[t]),s.splice(t,1,e),s[t+1].sort++,s[t].sort--}},saveGood:function(){this.floor_message.name.length>10||0==this.floor_message.name.length?this.$message({showClose:!0,message:"请填写符合要求的楼层名",type:"error"}):0==this.floor_message.data.length||this.floor_message.data.length>50?this.$message({showClose:!0,message:"商品至少添加一个且不能超过50个",type:"error"}):(this.$set(this.modules,this.currentModule,JSON.parse(i()(this.floor_message))),this.floorVisible=!1)},handleNav:function(t){t.show=!t.show},navTop:function(t,s,e){var a=void 0;if(a="first"==t?this.nav_message:this.nav_message[s].children,0!=e){var i=a[e-1];a.splice(e-1,1,a[e]),a.splice(e,1,i),a[e-1].cat_sort--,a[e].cat_sort++}},navBottom:function(t,s,e){var a=void 0;if(e!=(a="first"==t?this.nav_message:this.nav_message[s].children).length-1){var i=a[e+1];a.splice(e+1,1,a[e]),a.splice(e,1,i),a[e+1].sort++,a[e].sort--}},deleteNav:function(t,s,e){"first"==t?(this.nav_message=this.nav_message.filter(function(t){return t.cat_id!=e}),this.nav_message.map(function(t,s){t.cat_sort=s})):(this.nav_message[s].children=this.nav_message[s].children.filter(function(t){return t.cat_id!=e}),this.nav_message[s].children.map(function(t,s){t.cat_sort=s}))},saveNav:function(){this.nav=JSON.parse(i()(this.nav_message)),this.navVisible=!1},showCateDialog:function(){var t=this;this.cateVisible=!0,this.nav_message.map(function(s){t.checkedKey.push(s.cat_id),s.children&&s.children.length&&s.children.map(function(s){t.checkedKey.push(s.cat_id)})}),this.$nextTick(function(){t.$refs.tree.setCheckedKeys(t.checkedKey)})},saveCate:function(){for(var t=this,s=this.$refs.tree.getCheckedKeys(),e=[],a=[],i=0;i<this.shop_cat_list.length;i++)this.shop_cat_list[i].children?(a=this.shop_cat_list[i].children.filter(function(t){return-1!=s.indexOf(t.id)})).length>0&&(e.push(this.shop_cat_list[i]),e[e.length-1].children=a):-1!=s.indexOf(this.shop_cat_list[i].id)&&e.push(this.shop_cat_list[i]);this.nav_message=e,this.nav_message.map(function(s,e){s.cat_id=s.id,s.cat_name=s.label,s.cat_sort=e,t.$set(s,"show",!0),s.children&&s.children.map(function(t,s){t.cat_id=t.id,t.cat_name=t.label,t.cat_sort=s})}),this.cateVisible=!1},prePcDecorate:function(){var t={platform:"pc",modules_data:[]},s=[];this.nav&&this.nav.map(function(t){s.push({cat_id:t.cat_id,sort:t.cat_sort}),t.children&&(s[s.length-1].children=[],t.children.map(function(t){s[s.length-1].children.push({at_id:t.cat_id,sort:t.cat_sort})}))}),t.modules_data.push({name:"店铺分类导航",sort:1,data:{type:"nav",list:s}}),this.modules.map(function(s){if("coupon"==s.type)t.modules_data.push({name:"优惠券",sort:s.sort,data:{type:"coupon",is_show_coupon:"1"}});else{var e=[];s.data.map(function(t){e.push({item_id:t.id,sort:t.sort})}),t.modules_data.push({name:s.name,sort:s.sort,data:{type:"floor",item_list:e}})}}),n.a.prePcDecorate(t).then(function(t){0==t.code&&window.open(t.data.url)})},savePcDecorate:function(){var t=this,s={platform:"pc",modules_data:[]},e=[];this.nav&&this.nav.map(function(t){e.push({cat_id:t.cat_id,sort:t.cat_sort}),t.children&&(e[e.length-1].children=[],t.children.map(function(t){e[e.length-1].children.push({cat_id:t.cat_id,sort:t.cat_sort})}))}),s.modules_data.push({name:"店铺分类导航",sort:1,data:{type:"nav",list:e}}),this.modules.map(function(t){if("coupon"==t.type)s.modules_data.push({name:"优惠券",sort:t.sort,data:{type:"coupon",is_show_coupon:"1"}});else{var e=[];t.data.map(function(t){e.push({item_id:t.id,sort:t.sort})}),s.modules_data.push({name:t.name,sort:t.sort,data:{type:"floor",item_list:e}})}}),n.a.savePcDecorate(s).then(function(s){0==s.code&&(s.data.result&&t.$message({showClose:!0,message:"发布成功",type:"success"}),t.pcIndex({platform:"pc"}))})}},components:{SelectGoods:o.a},created:function(){this.pcIndex({platform:"pc"})}},r={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"main"},[e("el-card",[e("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("PC店铺装修")]),t._v(" "),e("div",{staticClass:"btnGroup"},[e("el-button",{on:{click:t.prePcDecorate}},[t._v("预览")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.savePcDecorate}},[t._v("发布")])],1)]),t._v(" "),e("div",{staticClass:"body"},[e("div",{staticClass:"left"},[e("i",{staticClass:"el-icon-tickets",on:{click:t.addCoupon}}),t._v(" "),e("p",[t._v("优惠券")]),t._v(" "),e("i",{staticClass:"el-icon-menu",on:{click:t.addFloor}}),t._v(" "),e("p",[t._v("楼层")])]),t._v(" "),e("div",{staticClass:"right"},[e("div",{staticClass:"title"},[e("img",{attrs:{width:"50",height:"50",src:t.sign.shop_logo+"_t.jpg",onerror:t.defaultImg}}),e("span",{staticClass:"name"},[t._v(t._s(t.sign.shop_name))])]),t._v(" "),e("div",{staticClass:"nav"},[e("ul",{staticClass:"nav-list"},[e("li",[t._v("所有分类")]),t._v(" "),e("li",[t._v("首页")]),t._v(" "),t._l(t.nav,function(s,a){return e("li",{key:a},[t._v(t._s(s.cat_name))])})],2),t._v(" "),e("el-button",{staticClass:"nav-btn",attrs:{type:"primary"},on:{click:t.showNavDialog}},[t._v("编辑")])],1),t._v(" "),e("div",{staticClass:"content"},t._l(t.modules,function(s,a){return"floor"==s.type?e("div",{key:a,staticClass:"goods"},[e("p",{staticClass:"goods-title"},[t._v("\n              "+t._s(s.name)+"\n              "),e("el-button",{staticClass:"fr",on:{click:function(e){return t.deleteFloor(s.sort)}}},[t._v("删除")]),t._v(" "),e("el-button",{staticClass:"fr",on:{click:function(e){return t.showFloorDialog(s,a)}}},[t._v("编辑")]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesBottom(a)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesTop(a)}}},[e("i",{staticClass:"el-icon-back up"})])],1),t._v(" "),e("div",{staticClass:"main"},[e("ul",{staticClass:"goods-list"},t._l(s.data,function(s){return e("li",[e("img",{attrs:{src:s.primary_image+"_s.jpg"}}),t._v(" "),e("p",{staticClass:"name"},[t._v(t._s(s.title))]),t._v(" "),e("span",[t._v("¥"+t._s(s.sell_price))])])}),0)])]):e("div",{staticClass:"coupons"},[e("p",{staticClass:"coupons-title"},[t._v("\n              优惠券\n              "),e("el-button",{staticClass:"fr",on:{click:function(e){return t.deleteFloor(s.sort)}}},[t._v("删除")]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesBottom(a)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.modulesTop(a)}}},[e("i",{staticClass:"el-icon-back up"})])],1),t._v(" "),e("div",{staticClass:"main"},[e("ul",{staticClass:"coupons-list"},t._l(s.data,function(s){return e("li",[e("p",[t._v(t._s(s.name))]),t._v(" "),e("p",[t._v("¥ "+t._s(s.deduct_money))]),t._v(" "),e("p",[t._v("满"+t._s(s.limit_money)+"可用")])])}),0)])])}),0)])])]),t._v(" "),e("el-dialog",{attrs:{title:"导航",visible:t.navVisible,"close-on-click-modal":!1},on:{"update:visible":function(s){t.navVisible=s}}},[e("span",[t._v("管理分类（未关联商品的分类不展示）")]),t._v(" "),e("div",{staticClass:"nav-dialog-body"},[e("div",{staticClass:"list"},[e("div",{staticClass:"first"},[e("i",{staticStyle:{"font-style":"normal"}},[t._v("首页")])])]),t._v(" "),t._l(t.nav_message,function(s,a){return e("div",{staticClass:"list"},[e("div",{staticClass:"first"},[e("i",{class:s.show?"el-icon-remove":"el-icon-circle-plus",on:{click:function(e){return t.handleNav(s)}}},[t._v(" "+t._s(s.cat_name))]),t._v(" "),e("el-button",{staticClass:"fr delete",attrs:{type:"primary"},on:{click:function(e){return t.deleteNav("first",0,s.cat_id)}}},[t._v("删除")]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.navBottom("first",0,a)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.navTop("first",0,a)}}},[e("i",{staticClass:"el-icon-back up"})])],1),t._v(" "),t._l(s.children,function(i,o){return e("div",{directives:[{name:"show",rawName:"v-show",value:s.children.length&&s.show,expression:"item.children.length&&item.show"}],staticClass:"second"},[e("i",{staticClass:"text"},[t._v(" "+t._s(i.cat_name))]),t._v(" "),e("el-button",{staticClass:"fr delete",attrs:{type:"primary"},on:{click:function(s){return t.deleteNav("second",a,i.cat_id)}}},[t._v("删除")]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.navBottom("second",a,o)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"fr",attrs:{type:"text"},on:{click:function(s){return t.navTop("second",a,o)}}},[e("i",{staticClass:"el-icon-back up"})])],1)})],2)})],2),t._v(" "),e("div",{staticClass:"nav-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.showCateDialog}},[e("i",{staticClass:"el-icon-plus"},[t._v("添加")])]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.saveNav}},[t._v(" 保存")])],1)]),t._v(" "),e("el-dialog",{attrs:{title:"添加导航分类",visible:t.cateVisible,"close-on-click-modal":!1},on:{"update:visible":function(s){t.cateVisible=s}}},[e("span",[t._v("管理分类（未关联商品的分类不展示）")]),t._v(" "),e("div",{staticClass:"nav-dialog-body"},[e("el-tree",{ref:"tree",attrs:{data:t.shop_cat_list,"show-checkbox":"","node-key":"id","highlight-current":"",props:t.defaultProps}})],1),t._v(" "),e("div",{staticClass:"nav-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.saveCate}},[t._v(" 保存")])],1)]),t._v(" "),e("el-dialog",{attrs:{title:"楼层",visible:t.floorVisible,"close-on-click-modal":!1},on:{"update:visible":function(s){t.floorVisible=s}}},[e("div",[e("span",[t._v("楼层标题：")]),t._v(" "),e("el-input",{attrs:{size:"small"},model:{value:t.floor_message.name,callback:function(s){t.$set(t.floor_message,"name",s)},expression:"floor_message.name"}}),t._v("\n      10个字符以内，推荐使用四个汉字\n    ")],1),t._v(" "),e("div",{staticClass:"floor-dialog-body"},[e("el-table",{attrs:{data:t.floor_message.data,border:""}},[e("el-table-column",{attrs:{label:"上传商品"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("img",{staticClass:"table-img",attrs:{width:"50",height:"50",src:s.row.primary_image+"_t.jpg"}}),t._v(" "),e("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(s.row.title))])]}}])}),t._v(" "),e("el-table-column",{attrs:{align:"center",width:"200",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.goodsTop(s.$index)}}},[e("i",{staticClass:"el-icon-back up"})]),t._v(" "),e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.goodsBottom(s.$index)}}},[e("i",{staticClass:"el-icon-back down "})]),t._v(" "),e("el-button",{staticClass:"delete",attrs:{type:"primary",size:"small"},on:{click:function(e){return t.deleteGood(s.row.id)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),e("div",{staticClass:"floor-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.selectVisible=!0}}},[e("i",{staticClass:"el-icon-plus"},[t._v("添加商品")])]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.saveGood}},[t._v(" 保存")])],1)]),t._v(" "),e("select-goods",{attrs:{selectVisible:t.selectVisible,onlyShelving:"1",selectList:[]},on:{"visible-change":t.handleVisible,"choose-submit":t.selectGoods}})],1)},staticRenderFns:[]};var d=e("C7Lr")(c,r,!1,function(t){e("Vag9")},"data-v-f66c9a74",null);s.default=d.exports},Vag9:function(t,s){}});